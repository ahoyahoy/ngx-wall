!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/common"),require("@angular/core"),require("rxjs"),require("@angular/material"),require("rxjs/operators"),require("@angular/forms"),require("ngx-sticky-modal"),require("codemirror"),require("codemirror/mode/javascript/javascript"),require("codemirror/mode/shell/shell"),require("codemirror/mode/xml/xml")):"function"==typeof define&&define.amd?define("ngx-wall",["exports","@angular/common","@angular/core","rxjs","@angular/material","rxjs/operators","@angular/forms","ngx-sticky-modal","codemirror","codemirror/mode/javascript/javascript","codemirror/mode/shell/shell","codemirror/mode/xml/xml"],e):e((t=t||self)["ngx-wall"]={},t.ng.common,t.ng.core,t.rxjs,t.ng.material,t.rxjs.operators,t.ng.forms,t.ngxStickyModal,t.CodeMirror)}(this,function(t,e,i,n,o,r,s,a,c){"use strict";c=c&&c.hasOwnProperty("default")?c["default"]:c;var l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};function p(t,e){function i(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var u=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};var d=function(){function t(){}return t.prototype.get=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t}(),h=function(){function t(t,e){this.base64=t,this.fileName=e}return t.prototype.getFile=function(){for(var t=this.base64.split(","),e=t[0].match(/:(.*?);/)[1],i=atob(t[1]),n=i.length,o=new Uint8Array(n);n--;)o[n]=i.charCodeAt(n);return new File([o],this.fileName,{type:e})},t}(),f=function(){function t(t){this.image=t}return t.prototype.getBase64Representation=function(){var t=this;return new Promise(function(e,i){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){i(t)},n.readAsDataURL(t.image)})},t}(),g=function(){function t(t,e,i){this.state={},this.id=t,this.tag=e,this.meta=i}return t.prototype.getState=function(){return JSON.parse(JSON.stringify(this.state))},t.prototype.updateState=function(t){return Object.keys(t).length?Object.assign(this.state,t):this.state={},this},t.prototype.turnInto=function(t){return this.tag=t,this.updateState({}),this},t.prototype.getSnapshot=function(){return{id:this.id,tag:this.tag,meta:this.meta,state:this.getState()}},t}(),y=function(){return function(t){this.brickId=t}}(),m=function(){return function(t){this.beforeEventType=t}}(),k=function(){return function(t,e){this.movedBrickIds=t}}(),v=function(){return function(t,e,i){this.brick=t,this.previousBrickId=e,this.nextBrickId=i}}(),b=function(){return function(t,e,i){this.bricks=t,this.previousBrickId=e,this.nextBrickId=i}}(),w=function(){return function(){}}(),B=function(){return function(t,e,i){this.brickId=t,this.newTag=e,this.oldTag=i}}(),S=function(){return function(t,e,i){this.brickId=t,this.brickState=e,this.oldBrickState=i}}(),x=function(){function t(t){this.brickRegistry=t,this.rows=[]}return t.prototype.getRowCount=function(){return this.rows.length},t.prototype.isBrickAheadOf=function(t,e){var i=this.getBrickSequence(function(){return!0}).map(function(t){return t.id});return i.indexOf(t)<i.indexOf(e)},t.prototype.getBrickTag=function(t){return this.getBrickById(t).tag},t.prototype.getBrickById=function(t){return this.getBrickSequence(function(e){return e.id===t})[0]},t.prototype.getBrickIds=function(){return this.getBrickSequence(function(){return!0}).map(function(t){return t.id})},t.prototype.filterBricks=function(t){return this.getBrickSequence(function(e){return t(e.getSnapshot())})},t.prototype.getBrickPosition=function(t){for(var e={rowIndex:null,columnIndex:null,brickIndex:null},i=0;null===e.rowIndex&&i<this.rows.length;)this.rows[i].columns.forEach(function(n,o){var r=null;n.bricks.forEach(function(e,i){e.id===t&&(r=i)}),(r||0===r)&&(e.rowIndex=i,e.columnIndex=o,e.brickIndex=r)}),i++;return e},t.prototype.getColumnCount=function(t){return this.rows[t].columns.length},t.prototype.getBricksCount=function(){return this.getBrickSequence(function(){return!0}).length},t.prototype.getNextBrick=function(t){var e=this.getBrickSequence(function(){return!0}),i=e.findIndex(function(e){return e.id===t});return e[i+1]},t.prototype.getNextBrickId=function(t){var e=this.getNextBrick(t);return e&&e.id},t.prototype.getPreviousBrick=function(t){var e=this.getBrickSequence(function(){return!0}),i=e.findIndex(function(e){return e.id===t});return e[i-1]},t.prototype.getPreviousBrickId=function(t){var e=this.getPreviousBrick(t);return e&&e.id},t.prototype.getBrickSequence=function(t){var e=[];return this.traverse(function(i){i.columns.forEach(function(i){i.bricks.forEach(function(i){t(i)&&e.push(i)})})}),e},t.prototype.getNextTextBrickId=function(t){var e=this.getNextTextBrick(t);return e&&e.id},t.prototype.getPreviousTextBrickId=function(t){var e=this.getPreviousTextBrick(t);return e&&e.id},t.prototype.getNextTextBrick=function(t){var e=this;return this.findBricksAfter(t,function(t){return e.brickRegistry.get(t.tag).supportText})[0]},t.prototype.getPreviousTextBrick=function(t){var e=this,i=this.findBrickBefore(t,function(t){return e.brickRegistry.get(t.tag).supportText});return i[i.length-1]},t.prototype.findBricksAfter=function(t,e){var i=[],n=this.getBrickSequence(function(){return!0}),o=n.map(function(t){return t.id}),r=o.indexOf(t);-1!==r&&o.splice(r+1).forEach(function(t){var o=n.find(function(e){return e.id===t});e(o)&&i.push(o)});return i},t.prototype.findBrickBefore=function(t,e){var i=[],n=this.getBrickSequence(function(){return!0}),o=n.map(function(t){return t.id}),r=o.indexOf(t);-1!==r&&o.splice(0,r).forEach(function(t){var o=n.find(function(e){return e.id===t});e(o)&&i.push(o)});return i},t.prototype.setLayout=function(t){this.rows=t},t.prototype.traverse=function(t){this.rows.forEach(function(e){t(e)})},t}(),C=function(){function t(t,e){this.brickRegistry=t,this.layoutWalker=e,this.rows=[]}return t.prototype.addBrickToNewRow=function(t,e,i){var n=this.rows.length-1;t>n+1&&(t=n+1),this.createNewRow(t,i||this.generateId()),this.addBrick(t,0,0,e)},t.prototype.addBrickToExistingColumn=function(t,e,i,n){var o=this.getColumn(t,e);if(o){var r=o.bricks.length;i>r+1&&(i=r+1),this.addBrick(t,e,i,n)}},t.prototype.addBrickToNewColumn=function(t,e,i){var n=this.rows[t];if(n){var o=n.columns.length;e>o+1&&(e=o+1),this.createNewColumn(t,e),this.addBrick(t,e,0,i)}},t.prototype.moveBrickAfterInNewRow=function(t,e){var i=this;e.reverse(),e.forEach(function(e){var n=i.layoutWalker.getBrickById(e);i.removeBrick(e);var o=i.layoutWalker.getBrickPosition(t).rowIndex+1;i.addBrickToNewRow(o,n)})},t.prototype.moveBrickAfterInSameColumn=function(t,e){var i=this;e.forEach(function(e,n){var o=i.layoutWalker.getBrickById(e);i.removeBrick(e);var r=i.layoutWalker.getBrickPosition(t);i.addBrickToExistingColumn(r.rowIndex,r.columnIndex,r.brickIndex+n+1,o)})},t.prototype.moveBrickBeforeInNewRow=function(t,e){var i=this;e.reverse(),e.forEach(function(n,o){var r,s=i.layoutWalker.getBrickById(n);i.removeBrick(n),r=0===o?i.layoutWalker.getBrickPosition(t):i.layoutWalker.getBrickPosition(e[o-1]),i.addBrickToNewRow(r.rowIndex,s)})},t.prototype.moveBrickBeforeInSameColumn=function(t,e){var i=this;e.forEach(function(e){var n=i.layoutWalker.getBrickById(e);i.removeBrick(e);var o=i.layoutWalker.getBrickPosition(t);i.addBrickToExistingColumn(o.rowIndex,o.columnIndex,o.brickIndex,n)})},t.prototype.moveBrickToNewColumn=function(t,e,i){var n,o=this,r=t.map(function(t){var e=o.layoutWalker.getBrickById(t);return o.removeBrick(t),e}),s=this.layoutWalker.getBrickPosition(e);"left"===i?n=s.columnIndex:"right"===i&&(n=s.columnIndex+1),r.forEach(function(t,e){0===e?o.addBrickToNewColumn(s.rowIndex,n,t):o.addBrickToExistingColumn(s.rowIndex,n,e,t)})},t.prototype.removeBrick=function(t){var e=this.layoutWalker.getBrickPosition(t),i=this.rows[e.rowIndex],n=i.columns[e.columnIndex];n.bricks.splice(e.brickIndex,1),0===n.bricks.length&&(i.columns.splice(e.columnIndex,1),0===i.columns.length&&(this.rows.splice(e.rowIndex,1),0===this.rows.length&&this.rows.push(this.initializeNewRow(this.generateId()))))},t.prototype.addBrick=function(t,e,i,n){this.rows[t].columns[e].bricks.splice(i,0,n)},t.prototype.getColumn=function(t,e){var i=this.rows[t];return i?i.columns[e]:null},t.prototype.createNewRow=function(t,e){this.rows.splice(t,0,this.initializeNewRow(e))},t.prototype.createNewColumn=function(t,e){this.rows[t].columns.splice(e,0,this.initializeNewColumn())},t.prototype.initializeNewRow=function(t){return{id:t,columns:[this.initializeNewColumn()]}},t.prototype.initializeNewColumn=function(){return{bricks:[]}},t.prototype.generateId=function(){return(new d).get()},t}(),M=function(){function t(t){this.brickRegistry=t,this.name="core",this.version="0.0.0",this.layoutWalker=new x(this.brickRegistry),this.DEFAULT_BRICK="text",this.events=new n.Subject}return t.prototype.onWallInitialize=function(t){var e=this;this.wallModel=t,["getRowCount","getBrickTag","getPreviousBrickId","getNextBrickId","getColumnCount","getBrickIds","getBricksCount","getNextTextBrickId","getPreviousTextBrickId","filterBricks","isBrickAheadOf"].forEach(function(t){e[t]=e.layoutWalker[t].bind(e.layoutWalker)}),this.wallModel.registerApi(this.name,this)},t.prototype.setPlan=function(t){var e=this;this.dispatch(new m(w)),this.layout=new C(this.brickRegistry,this.layoutWalker),this.layoutWalker.setLayout(this.layout.rows),t.layout.bricks.forEach(function(i,n){i.columns.forEach(function(o,r){o.bricks.forEach(function(o,s){var a=t.bricks.find(function(t){return o.id===t.id}),c=e.restoreBrick(a);0===r?0===s?e.layout.addBrickToNewRow(n,c,i.id):e.layout.addBrickToExistingColumn(n,r,s,c):0===s?e.layout.addBrickToNewColumn(n,r,c):e.layout.addBrickToExistingColumn(n,r,s,c)})})}),this.dispatch(new w)},t.prototype.addBrickAfterBrickId=function(t,e,i){this.dispatch(new m(y));var n=this.layoutWalker.getBrickPosition(t),o=this.layoutWalker.getColumnCount(n.rowIndex),r=this.createBrick(e,i);return 1===o?this.layout.addBrickToNewRow(n.rowIndex+1,r):o>1&&this.layout.addBrickToExistingColumn(n.rowIndex,n.columnIndex,n.brickIndex+1,r),this.dispatch(new y(r.id)),this.getBrickSnapshot(r.id)},t.prototype.addBrickBeforeBrickId=function(t,e,i){this.dispatch(new m(y));var n=this.layoutWalker.getBrickPosition(t),o=this.layoutWalker.getColumnCount(n.rowIndex),r=this.createBrick(e,i);return 1===o?this.layout.addBrickToNewRow(n.rowIndex,r):o>1&&this.layout.addBrickToExistingColumn(n.rowIndex,n.columnIndex,n.brickIndex,r),this.dispatch(new y(r.id)),this.getBrickSnapshot(r.id)},t.prototype.addDefaultBrick=function(){this.dispatch(new m(y));var t=this.layoutWalker.getBricksCount(),e=this.createBrick(this.DEFAULT_BRICK),i=t?this.layoutWalker.getRowCount()+1:0;this.layout.addBrickToNewRow(i,e),this.dispatch(new y(e.id))},t.prototype.addBrickAtStart=function(t,e){this.dispatch(new m(y));var i=this.createBrick(t,e);return this.layout.addBrickToNewRow(0,i),this.dispatch(new y(i.id)),this.getBrickSnapshot(i.id)},t.prototype.updateBrickState=function(t,e){this.dispatch(new m(S));var i=this.layoutWalker.getBrickById(t),n=JSON.parse(JSON.stringify(i.getState()));i.updateState(JSON.parse(JSON.stringify(e))),this.dispatch(new S(t,JSON.parse(JSON.stringify(i.getState())),n))},t.prototype.removeBrick=function(t){this.dispatch(new m(v));var e=this.layoutWalker.getNextTextBrick(t),i=this.layoutWalker.getPreviousTextBrick(t);this.clearBrickResources(t).then(function(){});var n=this.layoutWalker.getBrickById(t);this.layout.removeBrick(t),this.dispatch(new v(n.getSnapshot(),i&&i.id,e&&e.id))},t.prototype.removeBricks=function(t){var e=this;this.dispatch(new m(b));var i=this.layoutWalker.getNextBrick(t[t.length-1]),n=this.layoutWalker.getPreviousBrick(t[0]),o=t.map(function(t){return e.clearBrickResources(t)});Promise.all(o).then(function(){});var r=t.map(function(t){var i=e.layoutWalker.getBrickById(t);return e.layout.removeBrick(t),{id:i.id,tag:i.tag,state:i.state}});this.dispatch(new b(r,n&&n.id,i&&i.id))},t.prototype.clear=function(){var t=this,e=this.layoutWalker.getBrickIds(),i=e.map(function(e){return t.clearBrickResources(e)});return Promise.all(i).then(function(){e.forEach(function(e){t.layout.removeBrick(e)})})},t.prototype.turnBrickInto=function(t,e,i){void 0===i&&(i={}),this.dispatch(new m(B));var n=this.layoutWalker.getBrickById(t),o=n.tag;n.turnInto(e).updateState(i),this.dispatch(new B(t,e,o))},t.prototype.moveBrickAfterBrickId=function(t,e){if(-1===t.indexOf(e)){this.dispatch(new m(k));var i=this.layoutWalker.getBrickPosition(e);1===this.layoutWalker.getColumnCount(i.rowIndex)?this.layout.moveBrickAfterInNewRow(e,t):this.layout.moveBrickAfterInSameColumn(e,t),this.dispatch(new k(t,e))}},t.prototype.moveBrickBeforeBrickId=function(t,e){if(-1===t.indexOf(e)){this.dispatch(new m(k));var i=this.layoutWalker.getBrickPosition(e);1===this.layoutWalker.getColumnCount(i.rowIndex)?this.layout.moveBrickBeforeInNewRow(e,t):this.layout.moveBrickBeforeInSameColumn(e,t),this.dispatch(new k(t,e))}},t.prototype.moveBrickToNewColumn=function(t,e,i){-1===t.indexOf(e)&&(this.dispatch(new m(k)),this.layout.moveBrickToNewColumn(t,e,i),this.dispatch(new k(t,e)))},t.prototype.getPlan=function(){var t={bricks:[],layout:{bricks:[]}};return this.layoutWalker.traverse(function(e){var i=[];e.columns.forEach(function(e){var n={bricks:[]};e.bricks.forEach(function(e){t.bricks.push({id:e.id,tag:e.tag,meta:e.meta,data:e.state}),n.bricks.push({id:e.id})}),i.push(n)}),t.layout.bricks.push({columns:i,id:e.id})}),JSON.parse(JSON.stringify(t))},t.prototype.sortBrickIdsByLayoutOrder=function(t){return this.layoutWalker.getBrickSequence(function(){return!0}).filter(function(e){return-1!==t.indexOf(e.id)}).map(function(t){return t.id})},t.prototype.traverse=function(t){return this.layoutWalker.traverse(function(e){var i={id:e.id,columns:e.columns.map(function(t){return{bricks:t.bricks.map(function(t){return t.getSnapshot()})}})};t(i)})},t.prototype.getBrickSnapshot=function(t){var e=this.layoutWalker.getBrickById(t);return e?e.getSnapshot():null},t.prototype.getBrickResourcePaths=function(t){var e=this.layoutWalker.getBrickById(t),i=this.brickRegistry.get(e.tag);return i.getBrickResourcePaths?i.getBrickResourcePaths(e.getSnapshot()):[]},t.prototype.getBrickTextRepresentation=function(t){var e=this.layoutWalker.getBrickById(t),i=this.brickRegistry.get(e.tag);return i.textRepresentation&&new i.textRepresentation(e.getSnapshot()).getText()||""},t.prototype.subscribe=function(t){return this.events.subscribe(t)},t.prototype.isRegisteredBrick=function(t){return Boolean(this.brickRegistry.get(t))},t.prototype.dispatch=function(t){this.events.next(t)},t.prototype.createBrick=function(t,e){var i=this.generateGuid(),n=new g(i,t,{});return e&&n.updateState(e),n},t.prototype.restoreBrick=function(t){var e=new g(t.id,t.tag,t.meta);return e.updateState(t.data),e},t.prototype.clearBrickResources=function(t){var e=this.layoutWalker.getBrickById(t),i=this.brickRegistry.get(e.tag);return i.destructor?i.destructor(e.getSnapshot()):Promise.resolve()},t.prototype.generateGuid=function(){return(new d).get()},t}(),I=function(){return function(t){this.pluginName=t}}(),P=function(){function t(t,e){var i=this;this.brickRegistry=t,this.api={core:null},this.events$=new n.Subject,this.plugins=new Map,e.plugins.forEach(function(t){return i.initializePlugin(t)})}return t.prototype.registerApi=function(t,e){this.api[t]=e},t.prototype.destroy=function(){var t=this;this.plugins.forEach(function(e){return t.destroyPlugin(e)})},t.prototype.subscribe=function(t){return this.events$.subscribe(t)},t.prototype.dispatch=function(t){this.events$.next(t)},t.prototype.initializePlugin=function(t){t.onWallInitialize(this),this.plugins.set(t.name,t),this.dispatch(new I(t.name))},t.prototype.destroyPlugin=function(t){t.onWallPluginDestroy&&t.onWallPluginDestroy()},t}(),T=function(){function t(){this.bricks=[]}return t.prototype.register=function(t){this.bricks.push(t)},t.prototype.get=function(t){return this.bricks.find(function(e){return e.tag===t})},t.prototype.getAll=function(){return this.bricks},t.decorators=[{type:i.Injectable}],t}(),R=function(){function t(t){this.brickRegistry=t}return t.prototype.create=function(t){(t=u({},{plan:{bricks:[],layout:{bricks:[]}},plugins:[]},t)).plugins.unshift(new M(this.brickRegistry));var e=new P(this.brickRegistry,t);return e.api.core.setPlan(t.plan),e},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:T}]},t}(),E=function(){function t(){}return t.prototype.setCoordinate=function(t,e,i,n){this.x=t,this.y=e,this.size=i,this.isHorizontal=n},t.decorators=[{type:i.Component,args:[{template:'<div *ngIf="x">\n    <div *ngIf="isHorizontal"\n         [style.left.px]="x"\n         [style.top.px]="y"\n         [style.width.px]="size"\n         [style.height.px]="3"\n         class="tow-placeholder">\n    </div>\n\n    <div *ngIf="!isHorizontal"\n         [style.left.px]="x"\n         [style.top.px]="y"\n         [style.width.px]="3"\n         [style.height.px]="size"\n         class="tow-placeholder">\n    </div>\n</div>',styles:[".tow-placeholder{opacity:.5;position:fixed;border-radius:2px}"]}]}],t}(),O=function(){function t(t,e,i){this.componentFactoryResolver=t,this.appRef=e,this.injector=i,this.placeholderComponentRef=null}return t.prototype.render=function(t,e,i,n){void 0===n&&(n=!0),this.placeholderComponentRef||this.renderPlaceholderComponent(),this.setCoordinate(t,e,i,n)},t.prototype.clear=function(){this.placeholderComponentRef&&this.removePlaceholderComponent()},t.prototype.renderPlaceholderComponent=function(){this.placeholderComponentRef=this.componentFactoryResolver.resolveComponentFactory(E).create(this.injector),this.appRef.attachView(this.placeholderComponentRef.hostView);var t=this.placeholderComponentRef.hostView.rootNodes[0];document.body.appendChild(t)},t.prototype.removePlaceholderComponent=function(){this.appRef.detachView(this.placeholderComponentRef.hostView),this.placeholderComponentRef.destroy(),this.placeholderComponentRef=null},t.prototype.setCoordinate=function(t,e,i,n){this.placeholderComponentRef.instance.setCoordinate(t,e,i,n)},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:i.ComponentFactoryResolver},{type:i.ApplicationRef},{type:i.Injector}]},t}(),D=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule],declarations:[E],providers:[O],entryComponents:[E]}]}],t}(),N=function(){function t(t){this.rows=[],this.selectedBricks=null,this.focusedBrick=null,this.canvasClick=new i.EventEmitter,this.onBrickStateChanged=new i.EventEmitter,this.focusedBrick$=new n.Subject,this.selectedBricks$=new n.Subject,this.doc=null,this.doc=t}return t.prototype.onEditorClick=function(t){t.target===this.expander.nativeElement&&this.canvasClick.emit()},t.prototype.ngOnChanges=function(t){t.focusedBrick&&t.focusedBrick.currentValue&&this.focusedBrick$.next(t.focusedBrick.currentValue),t.selectedBricks&&this.selectedBricks$.next(t.selectedBricks.currentValue||[])},t.prototype.brickStateChanged=function(t,e){this.onBrickStateChanged.emit({brickId:t,brickState:e})},t.prototype.trackRowsBy=function(t,e){return e.id},t.decorators=[{type:i.Component,args:[{selector:"wall-canvas",template:'<div #editor class="wall-canvas__editor" (click)="onEditorClick($event)">\n    <wall-canvas-row *ngFor="let row of rows; trackBy: trackRowsBy" [row]="row"></wall-canvas-row>\n\n    <div #expander class="wall-canvas__expander"></div>\n</div>\n',styles:[":host{display:block}:host .wall-canvas__editor{min-height:200px;cursor:text}:host .wall-canvas__expander{min-height:250px}"]}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:i.Inject,args:[e.DOCUMENT]}]}]},t.propDecorators={wallModel:[{type:i.Input}],rows:[{type:i.Input}],selectedBricks:[{type:i.Input}],focusedBrick:[{type:i.Input}],isMediaInteractionEnabled$:[{type:i.Input}],canvasClick:[{type:i.Output}],onBrickStateChanged:[{type:i.Output}],expander:[{type:i.ViewChild,args:["expander"]}]},t}(),A=function(){return function(t){this.spots=t}}(),L=function(){function t(t){this.id=t.id,this.instance=t,this.updateInfo()}return t.prototype.updateInfo=function(){var t=this.instance.getInfo(),e=t.position,i=t.size,n=t.data;this.data=n,this.size=i,this.position=e},t.prototype.isCross13Line=function(t){return t>this.position.y&&t<this.position.y+this.size.height},t.prototype.getMinimalDistanceToPoint=function(t,e){var i=Math.abs(this.position.y-e),n=Math.abs(this.position.y+this.size.height-e),o=Math.abs(this.position.x-t),r=Math.abs(this.position.x+this.size.width-t),s=Math.min.apply(null,[i,n]),a=Math.min.apply(null,[o,r]);return t>this.position.x&&t<this.position.x+this.size.width?s:e>this.position.y&&e<this.position.y+this.size.height?a:Math.sqrt(s*s+a*a)},t.prototype.getDistanceToTopLeftPoint=function(t,e){var i=Math.abs(this.position.x-t),n=Math.abs(this.position.y-e);return Math.sqrt(i*i+n*n)},t.prototype.getDistanceToBottomLeftPoint=function(t,e){var i=Math.abs(this.position.x-t),n=Math.abs(this.position.y+this.size.height-e);return Math.sqrt(i*i+n*n)},t.prototype.getDistanceToLeftCenterPoint=function(t,e){var i=Math.abs(this.position.x-t),n=Math.abs(this.position.y+this.size.height/2-e);return Math.sqrt(i*i+n*n)},t.prototype.isPointInsideSpot=function(t,e){return t>this.position.x&&t<this.position.x+this.size.width&&e>this.position.y&&e<this.position.y+this.size.height},t}(),_=function(){function t(t,e){var i=this;this.zone=e,this.spots=new Map,this.events=new n.Subject,this.mouseMove$=n.fromEvent(t,"mousemove");this.zone.runOutsideAngular(function(){i.mouseMove$.pipe(r.throttleTime(30)).subscribe(function(t){i.updateSpotsInfo(),i.updateLocationPosition(t.clientX,t.clientY)})})}return t.prototype.register=function(t,e){this.spots.set(t,new L(e))},t.prototype.unRegister=function(t){this.spots["delete"](t)},t.prototype.updateSpotsInfo=function(){this.spots.forEach(function(t){return t.updateInfo()})},t.prototype.filterSpots=function(t){return Array.from(this.spots).map(function(t){var e=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(i=r["return"])&&i.call(r)}finally{if(o)throw o.error}}return s}(t,2);e[0];return e[1]}).filter(function(e){return t(e)})},t.prototype.subscribe=function(t){return this.events.subscribe(t)},t.prototype.updateLocationPosition=function(t,e){var i=[];this.spots.forEach(function(n){var o=n.getMinimalDistanceToPoint(t,e),r=n.getDistanceToTopLeftPoint(t,e),s=n.getDistanceToBottomLeftPoint(t,e),a=n.getDistanceToLeftCenterPoint(t,e),c=n.isCross13Line(e);i.push({minimalDistance:o,topLeftPointDistance:r,bottomLeftPointDistance:s,centerLeftPointDistance:a,isCross13Line:c,data:n.data})}),this.events.next(new A(i))},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:i.Inject,args:[e.DOCUMENT]}]},{type:i.NgZone}]},t}(),z=function(){function t(t){var e=this;this.radarCoordinator=t,this.events=new n.Subject,this.radarCoordinator.subscribe(function(t){e.events.next(t)})}return t.prototype.filterSpots=function(t){return this.radarCoordinator.filterSpots(t)},t.prototype.subscribe=function(t){return this.events.subscribe(t)},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:_}]},t}(),F=function(){function t(t,e,i,n,o){this.injector=t,this.resolver=e,this.radar=i,this.cdRef=n,this.wallCanvasComponent=o,this.selected=!1,this.isMouseNear=!1,this.isMediaInteractionEnabled=!0,this.minimalDistanceToMouse=100}return t.prototype.ngOnInit=function(){var t=this;this.spot={brickId:this.brick.id,isPickOutItem:!0,isBeacon:!0},this.componentReference=this.renderBrick(),this.radarSubscription=this.radar.subscribe(function(e){if(e instanceof A){var i=e.spots.find(function(e){return e.data.brickId===t.brick.id});i.isCross13Line?t.isMouseNear=i.topLeftPointDistance<t.minimalDistanceToMouse:t.isMouseNear=!1,t.cdRef.detectChanges()}}),this.focusedBrickSubscription=this.wallCanvasComponent.focusedBrick$.subscribe(function(e){e.id===t.brick.id&&t.callInstanceApi("onWallFocus",e.context)}),this.selectedBricksSubscription=this.wallCanvasComponent.selectedBricks$.subscribe(function(e){t.selected=!Boolean(-1===e.indexOf(t.brick.id))}),this.isMediaInteractionEnabledSubscription=this.wallCanvasComponent.isMediaInteractionEnabled$.subscribe(function(e){return t.isMediaInteractionEnabled=e})},t.prototype.ngOnChanges=function(t){t.brick&&!t.brick.firstChange&&t.brick.currentValue&&(this.componentReference.instance.state=this.brick.state,this.callInstanceApi("onWallStateChange",this.componentReference.instance.state))},t.prototype.ngOnDestroy=function(){this.radarSubscription.unsubscribe(),this.focusedBrickSubscription.unsubscribe(),this.selectedBricksSubscription.unsubscribe(),this.isMediaInteractionEnabledSubscription.unsubscribe(),this.stateChangesSubscription&&this.stateChangesSubscription.unsubscribe()},t.prototype.callInstanceApi=function(t,e){this.componentReference.instance[t]&&this.componentReference.instance[t](e)},t.prototype.renderBrick=function(){var t=this,e=this.resolver.resolveComponentFactory(this.brick.component),i=this.container.createComponent(e,null,this.injector),n=i.instance;return n.id=this.brick.id,n.state=this.brick.state,n.wallModel=this.wallCanvasComponent.wallModel,n.stateChanges&&(this.stateChangesSubscription=n.stateChanges.subscribe(function(e){t.wallCanvasComponent.brickStateChanged(t.brick.id,e)})),i},t.decorators=[{type:i.Component,args:[{selector:"wall-canvas-brick",template:'<div [spot]="spot"\n     data-id="{{brick.id}}"\n     class="wall-canvas-brick__wrapper wall-canvas-brick__draggable"\n     [ngClass]="{\'wall-canvas-brick__selected\': selected,\n     \t\t\'wall-canvas-brick__draggable\': isMouseNear}">\n\n    <div class="wall-canvas-brick__draggable-handler" [tow-slave]="brick.id">\n        <div class="wall-canvas-brick__draggable-box">\n            <mat-icon>drag_handle</mat-icon>\n        </div>\n    </div>\n\n    <div [ngClass]="{\'wall-canvas-brick__disabled-interaction\': !isMediaInteractionEnabled}">\n        <ng-container #brickContainer></ng-container>\n    </div>\n</div>\n',styles:[':host{display:block;margin:0 0 2px}:host .wall-canvas-brick__draggable .wall-canvas-brick__draggable-handler{display:block}:host .wall-canvas-brick__wrapper{position:relative}:host .wall-canvas-brick__wrapper:after{content:"";position:absolute;top:0;bottom:0;left:0;right:0;pointer-events:none;opacity:.2;transition:background-color .1s}:host .wall-canvas-brick__draggable-box{padding:1px;border-radius:3px;line-height:0}:host .wall-canvas-brick__draggable-handler{display:none;position:absolute;left:-35px;top:-4px;padding:5px;margin:0;cursor:pointer;border-radius:3px}:host .wall-canvas-brick__selected{position:relative}:host .wall-canvas-brick__disabled-interaction{pointer-events:none}']}]}],t.ctorParameters=function(){return[{type:i.Injector},{type:i.ComponentFactoryResolver},{type:z},{type:i.ChangeDetectorRef},{type:N}]},t.propDecorators={brick:[{type:i.Input}],container:[{type:i.ViewChild,args:["brickContainer",{read:i.ViewContainerRef}]}]},t}(),W=function(){function t(){}return t.prototype.trackColumnsBy=function(t){return t},t.prototype.trackBricksBy=function(t,e){return e.hash},t.decorators=[{type:i.Component,args:[{selector:"wall-canvas-row",template:'<div class="wall-canvas-row__column" *ngFor="let column of row.columns; trackBy: trackColumnsBy">\n    <wall-canvas-brick [brick]="brick" *ngFor="let brick of column.bricks; trackBy: trackBricksBy"></wall-canvas-brick>\n</div>',styles:[":host{display:flex}:host .wall-canvas-row__column{flex:1;margin:0 10px;min-width:0}:host .wall-canvas-row__column:first-child{margin-left:0}:host .wall-canvas-row__column:last-child{margin-right:0}"]}]}],t.propDecorators={row:[{type:i.Input}]},t}(),j=function(){return function(t){this.selectedBrickIds=t}}(),H=function(){function t(t){this.brickRegistry=t,this.wallModel=null,this.events=new n.Subject,this.focusedBrick=null,this.selectedBricks=[],this.isMediaInteractionEnabled$=new n.BehaviorSubject(!0),this.canvasLayout=[]}return t.prototype.getCanvasLayout=function(){var t=this,e=[];return this.wallModel.api.core.traverse(function(i){e.push({id:i.id,columns:i.columns.map(function(e){return{bricks:e.bricks.map(function(e){var i=t.brickRegistry.get(e.tag).component;return{id:e.id,hash:e.tag+e.id,state:e.state,component:i}})}})})}),e},t.prototype.initialize=function(t){var e=this;this.wallModel=t;var i=["getSelectedBrickIds","selectBrick","selectBricks","addBrickToSelection","removeBrickFromSelection","unSelectBricks","focusOnBrickId","getFocusedBrickId","focusOnPreviousTextBrick","focusOnNextTextBrick","removeBrick","removeBricks","enableMediaInteraction","disableMediaInteraction","subscribe"].reduce(function(t,i){return e[i].bind?t[i]=e[i].bind(e):t[i]=e[i],t},{});Object.seal(i),this.wallModel.registerApi("ui",i),this.wallModelSubscription=this.wallModel.api.core.subscribe(function(t){t instanceof B&&e.focusOnBrickId(t.brickId),t instanceof k&&e.unSelectBricks(),t instanceof b&&(e.wallModel.api.core.getBricksCount()||e.wallModel.api.core.addDefaultBrick()),t instanceof m||(e.canvasLayout=e.getCanvasLayout())}),this.canvasLayout=this.getCanvasLayout()},t.prototype.selectBrick=function(t){this.selectedBricks=[t],this.focusedBrick=null;var e=this.selectedBricks.slice(0);this.dispatch(new j(e))},t.prototype.selectBricks=function(t){if(JSON.stringify(t)!==JSON.stringify(this.selectedBricks)){this.selectedBricks=this.wallModel.api.core.sortBrickIdsByLayoutOrder(t);var e=this.selectedBricks.slice(0);this.dispatch(new j(e))}},t.prototype.addBrickToSelection=function(t){var e=this.selectedBricks.slice(0);e.push(t),this.selectedBricks=this.wallModel.api.core.sortBrickIdsByLayoutOrder(e);var i=this.selectedBricks.slice(0);this.dispatch(new j(i))},t.prototype.removeBrickFromSelection=function(t){var e=this.selectedBricks.indexOf(t);this.selectedBricks.splice(e,1),this.selectedBricks=this.selectedBricks.slice(0);var i=this.selectedBricks.slice(0);this.dispatch(new j(i))},t.prototype.unSelectBricks=function(){this.selectedBricks=[],this.dispatch(new j([]))},t.prototype.getSelectedBrickIds=function(){return this.selectedBricks.slice(0)},t.prototype.getFocusedBrickId=function(){return this.focusedBrick&&this.focusedBrick.id},t.prototype.focusOnBrickId=function(t,e){this.focusedBrick={id:t,context:e}},t.prototype.focusOnPreviousTextBrick=function(t,e){var i=this.wallModel.api.core.getPreviousTextBrickId(t);i&&this.focusOnBrickId(i,e)},t.prototype.focusOnNextTextBrick=function(t,e){var i=this.wallModel.api.core.getNextTextBrickId(t);i&&this.focusOnBrickId(i,e)},t.prototype.enableMediaInteraction=function(){this.isMediaInteractionEnabled$.next(!0)},t.prototype.disableMediaInteraction=function(){this.isMediaInteractionEnabled$.next(!1)},t.prototype.subscribe=function(t){return this.events.subscribe(t)},t.prototype.removeBrick=function(t){this.removeBricks([t])},t.prototype.removeBricks=function(t){var e=this.wallModel.api.core.getBrickIds();if(e.length>1)this.wallModel.api.core.removeBricks(t);else if(1===e.length){var i=this.wallModel.api.core.getBrickSnapshot(e[0]);"text"!==i.tag||i.state.text?this.wallModel.api.core.removeBricks(t):this.focusOnBrickId(e[0])}},t.prototype.onCanvasClick=function(){var t=this.wallModel.api.core.getRowCount(),e=this.wallModel.api.core.getBrickIds();if(t>0&&1===this.wallModel.api.core.getColumnCount(t-1)&&e.length){var i=this.wallModel.api.core.getBrickSnapshot(e[e.length-1]);"text"!==i.tag||i.state.text?this.wallModel.api.core.addDefaultBrick():this.focusOnBrickId(i.id)}else this.wallModel.api.core.addDefaultBrick()},t.prototype.onBrickStateChanged=function(t,e){this.wallModel.api.core.updateBrickState(t,e)},t.prototype.reset=function(){this.wallModelSubscription.unsubscribe(),this.wallModelSubscription=null,this.focusedBrick=null,this.unSelectBricks()},t.prototype.dispatch=function(t){this.events.next(t)},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:T}]},t}(),U=function(){function t(t){this.wallViewModel=t,this.model=null,this.configuration=null}return t.prototype.onCanvasClick=function(){this.wallViewModel.onCanvasClick()},t.prototype.onBrickStateChanged=function(t){this.wallViewModel.onBrickStateChanged(t.brickId,t.brickState)},t.prototype.ngOnChanges=function(t){t.model&&(t.model.firstChange||this.cleanUp(),this.initialize())},t.prototype.ngOnDestroy=function(){this.cleanUp()},t.prototype.initialize=function(){this.wallViewModel.initialize(this.model)},t.prototype.cleanUp=function(){this.wallViewModel.reset()},t.decorators=[{type:i.Component,args:[{selector:"wall",template:'<wall-canvas *ngIf="wallViewModel.canvasLayout"\n             (canvasClick)="onCanvasClick()"\n             (onBrickStateChanged)="onBrickStateChanged($event)"\n\n             [wallModel]="wallViewModel.wallModel"\n             [isMediaInteractionEnabled$]="wallViewModel.isMediaInteractionEnabled$"\n             [focusedBrick]="wallViewModel.focusedBrick"\n             [selectedBricks]="wallViewModel.selectedBricks"\n             [rows]="wallViewModel.canvasLayout">\n</wall-canvas>\n',providers:[H],styles:[""]}]}],t.ctorParameters=function(){return[{type:H}]},t.propDecorators={model:[{type:i.Input}],configuration:[{type:i.Input}]},t}(),K=function(){return function(t){this.slaveId=t}}(),V=function(){return function(t){this.slaveId=t}}(),$=function(){return function(t){this.mousePosition=t}}(),X=function(){function t(){var t=this;this.events=new n.Subject,this.isSlaveWorking=!1,document.addEventListener("dragover",function(e){t.isSlaveWorking&&(e.preventDefault(),e.dataTransfer.dropEffect="move",t.slaveWorkProgress(e.clientX,e.clientY))})}return t.prototype.slaveStartWorking=function(t){this.isSlaveWorking=!0,this.events.next(new K(t))},t.prototype.slaveWorkProgress=function(t,e){this.events.next(new $({clientX:t,clientY:e}))},t.prototype.slaveStopWorking=function(t){this.isSlaveWorking=!1,this.events.next(new V(t))},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[]},t}(),Y=function(){function t(t,e,i){this.renderer2=t,this.el=e,this.towCoordinator=i}return t.prototype.dragStart=function(t){t.dataTransfer.dropEffect="move",t.dataTransfer.setData("FAKE",JSON.stringify({})),this.towCoordinator.slaveStartWorking(this.id)},t.prototype.drag=function(t){t.dataTransfer.dropEffect="move"},t.prototype.dragEnd=function(t){t.preventDefault(),t.stopPropagation(),this.towCoordinator.slaveStopWorking(this.id)},t.prototype.ngOnInit=function(){this.renderer2.setAttribute(this.el.nativeElement,"draggable","true")},t.decorators=[{type:i.Directive,args:[{selector:"[tow-slave]"}]}],t.ctorParameters=function(){return[{type:i.Renderer2},{type:i.ElementRef},{type:X}]},t.propDecorators={id:[{type:i.Input,args:["tow-slave"]}],dragStart:[{type:i.HostListener,args:["dragstart",["$event"]]}],drag:[{type:i.HostListener,args:["drag",["$event"]]}],dragEnd:[{type:i.HostListener,args:["dragend",["$event"]]}]},t}(),q=function(){function t(t){var e=this;this.towCoordinator=t,this.events=new n.Subject,this.towCoordinator.events.subscribe(function(t){e.events.next(t)})}return t.prototype.subscribe=function(t){return this.events.subscribe(t)},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:X}]},t}(),J=function(){function t(t,e){this.radarCoordinator=t,this.el=e,this.id=String(Math.random())}return t.prototype.ngOnInit=function(){this.radarCoordinator.register(this.id,this)},t.prototype.getInfo=function(){return{id:this.id,data:this.getData(),size:this.getSize(),position:this.getPosition()}},t.prototype.getData=function(){return this.spot},t.prototype.getSize=function(){return{width:this.el.nativeElement.offsetWidth,height:this.el.nativeElement.offsetHeight}},t.prototype.getPosition=function(){var t=this.el.nativeElement.getBoundingClientRect();return{x:t.left,y:t.top}},t.prototype.ngOnDestroy=function(){this.radarCoordinator.unRegister(this.id)},t.decorators=[{type:i.Directive,args:[{selector:"[spot]"}]}],t.ctorParameters=function(){return[{type:_},{type:i.ElementRef}]},t.propDecorators={spot:[{type:i.Input}]},t}(),Z=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{exports:[J],declarations:[J],providers:[z,_]}]}],t}(),G=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,Z],declarations:[Y],exports:[Y],providers:[q,X]}]}],t}(),Q=function(){function t(){this.pickOutAreaModel=null}return t.prototype.initialize=function(t){this.pickOutAreaModel=t},t.decorators=[{type:i.Component,args:[{template:'<div *ngIf="pickOutAreaModel"\n     [style.left.px]="pickOutAreaModel.x"\n     [style.top.px]="pickOutAreaModel.y"\n     [style.width.px]="pickOutAreaModel.width"\n     [style.height.px]="pickOutAreaModel.height"\n     class="pick-out-area">\n</div>\n',styles:[".pick-out-area{opacity:.5;position:absolute}"]}]}],t}(),tt=function(){return function(){}}(),et=function(){return function(t){this.ids=t}}(),it=function(){return function(){}}(),nt=function(){return function(){}}(),ot=function(){function t(t){this.radar=t,this.changes=new n.Subject,this.isPickOutAllowed=!0}return t.prototype.disablePickOut=function(){this.isPickOutAllowed=!1},t.prototype.enablePickOut=function(){this.isPickOutAllowed=!0},t.prototype.stopPickOut=function(){this.changes.next(new nt)},t.prototype.startPickOut=function(){this.changes.next(new it)},t.prototype.pickOutChanged=function(t){var e=this.radar.filterSpots(function(t){return t.data.isPickOutItem});e.forEach(function(t){t.updateInfo()}),this.changes.next(new et(this.getSelectedItemIds(t,e)))},t.prototype.endPickOut=function(){this.changes.next(new tt)},t.prototype.getSelectedItemIds=function(t,e){return e.filter(function(e){return t.x<e.position.x+e.size.width&&t.x+t.width>e.position.x&&t.y+t.height>e.position.y&&t.y<e.position.y+e.size.height}).map(function(t){return t.data.brickId})},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:z}]},t}(),rt=function(){function t(t,e,i,n){this.isPickOutProcessInitialized=!1,this.minimumMoveDistance=5,this.scrollableContainer=t,this.initialX=e,this.initialY=i,this.x=e,this.y=i,this.initialBrickId=n,this.currentBrickId=n}return t.prototype.recalculatePositionAndSize=function(){var t=this.scrollableContainer.getBoundingClientRect(),e=this.previousClientX-t.left,i=this.previousClientY-t.top+this.scrollableContainer.scrollTop;this.updatePickOutAreaPositionAndSize(e,i)},t.prototype.updateCurrentClientPosition=function(t,e){this.previousClientX=t,this.previousClientY=e,this.recalculatePositionAndSize()},t.prototype.updateCurrentBrickId=function(t){this.currentBrickId=t},t.prototype.canInitiatePickOutProcess=function(){return this.isMouseMovedEnough()&&(!this.currentBrickId||this.currentBrickId!==this.initialBrickId)},t.prototype.initiatePickOutProcess=function(){this.isPickOutProcessInitialized=!0},t.prototype.updatePickOutAreaPositionAndSize=function(t,e){t<this.initialX?(this.width=this.initialX-t,this.x=t):this.width=Math.abs(t-this.x),e<this.initialY?(this.height=this.initialY-e,this.y=e):this.height=Math.abs(e-this.y);var i=this.scrollableContainer.getBoundingClientRect();this.clientX=i.left+this.x,this.clientY=i.top+this.y-this.scrollableContainer.scrollTop},t.prototype.isMouseMovedEnough=function(){return this.width>this.minimumMoveDistance||this.height>this.minimumMoveDistance},t}(),st=function(){function t(t,e,i,n,o,r,s){this.pickOutCoordinator=e,this.componentFactoryResolver=i,this.appRef=n,this.zone=o,this.el=r,this.injector=s,this.doc=null,this.pickOutAreaModel=null,this.selectionRangeComponentRef=null,this.doc=t}return t.prototype.ngOnInit=function(){this.onMouseUpBound=this.onMouseUp.bind(this),this.onMouseMoveBound=this.onMouseMove.bind(this),this.onSelectionStartBound=this.onSelectionStart.bind(this),this.onContainerScrollBound=this.onContainerScroll.bind(this),this.doc.addEventListener("mousemove",this.onMouseMoveBound),this.doc.addEventListener("mouseup",this.onMouseUpBound),this.doc.addEventListener("selectstart",this.onSelectionStartBound),this.config.scrollableContainer.addEventListener("scroll",this.onContainerScrollBound)},t.prototype.triggerPickOutChanged=function(){this.pickOutCoordinator.pickOutChanged({x:this.pickOutAreaModel.clientX,y:this.pickOutAreaModel.clientY,width:this.pickOutAreaModel.width,height:this.pickOutAreaModel.height})},t.prototype.mouseDown=function(t){if(0===t.button&&!this.isMouseOverDraggableElement(t.clientX,t.clientY)){var e=this.config.scrollableContainer.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top+this.config.scrollableContainer.scrollTop,o=this.findBrickIdByCoordinate(t.clientX,t.clientY);this.pickOutAreaModel=new rt(this.config.scrollableContainer,i,n,o)}},t.prototype.onMouseMove=function(t){this.pickOutAreaModel&&(this.pickOutAreaModel.updateCurrentClientPosition(t.clientX,t.clientY),this.pickOutAreaModel.updateCurrentBrickId(this.findBrickIdByCoordinate(t.clientX,t.clientY)),this.pickOutAreaModel.isPickOutProcessInitialized?(t.preventDefault(),this.triggerPickOutChanged()):this.pickOutAreaModel.canInitiatePickOutProcess()&&(this.pickOutAreaModel.initiatePickOutProcess(),this.onStartPicKOut()))},t.prototype.onMouseUp=function(){this.onStopPickOut()},t.prototype.onContainerScroll=function(){this.pickOutAreaModel&&this.pickOutAreaModel.isPickOutProcessInitialized&&(this.pickOutAreaModel.recalculatePositionAndSize(),this.triggerPickOutChanged())},t.prototype.onSelectionStart=function(t){this.pickOutAreaModel&&this.pickOutAreaModel.isPickOutProcessInitialized&&t.preventDefault()},t.prototype.renderRangeComponent=function(){this.selectionRangeComponentRef=this.componentFactoryResolver.resolveComponentFactory(Q).create(this.injector),this.selectionRangeComponentRef.instance.initialize(this.pickOutAreaModel),this.appRef.attachView(this.selectionRangeComponentRef.hostView);var t=this.selectionRangeComponentRef.hostView.rootNodes[0];this.config.scrollableContainer.appendChild(t)},t.prototype.removeRangeComponent=function(){this.appRef.detachView(this.selectionRangeComponentRef.hostView),this.selectionRangeComponentRef.destroy(),this.selectionRangeComponentRef=null},t.prototype.onStartPicKOut=function(){this.pickOutCoordinator.startPickOut(),this.doc.activeElement.blur(),this.renderRangeComponent(),this.clearSelection()},t.prototype.onStopPickOut=function(){this.pickOutAreaModel&&this.pickOutAreaModel.isPickOutProcessInitialized&&(this.removeRangeComponent(),this.pickOutCoordinator.endPickOut()),this.pickOutAreaModel=null},t.prototype.ngOnDestroy=function(){this.doc.removeEventListener("mouseup",this.onMouseUpBound),this.doc.removeEventListener("mousemove",this.onMouseMoveBound),this.doc.removeEventListener("selectstart",this.onSelectionStartBound),this.config.scrollableContainer.removeEventListener("scroll",this.onContainerScrollBound)},t.prototype.clearSelection=function(){window.getSelection().empty()},t.prototype.findBrickIdByCoordinate=function(t,e){for(var i=document.elementFromPoint(t,e);i&&"WALL-CANVAS-BRICK"!==i.tagName;)i=i.parentElement;return i?i.getElementsByClassName("wall-canvas-brick__wrapper")[0].getAttribute("id"):null},t.prototype.isMouseOverDraggableElement=function(t,e){for(var i=document.elementFromPoint(t,e);i&&!i.draggable&&!i.classList.contains("wall-canvas-brick__draggable-box");)i=i.parentElement;return Boolean(i)},t.decorators=[{type:i.Directive,args:[{selector:"[pick-out-area]"}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:i.Inject,args:[e.DOCUMENT]}]},{type:ot},{type:i.ComponentFactoryResolver},{type:i.ApplicationRef},{type:i.NgZone},{type:i.ElementRef},{type:i.Injector}]},t.propDecorators={config:[{type:i.Input,args:["pick-out-area"]}],mouseDown:[{type:i.HostListener,args:["mousedown",["$event"]]}]},t}(),at=function(){function t(t){var e=this;this.pickOutHandlerService=t,this.events=new n.Subject,this.pickOutHandlerService.changes.subscribe(function(t){e.events.next(t)})}return t.prototype.enablePickOut=function(){this.pickOutHandlerService.enablePickOut()},t.prototype.disablePickOut=function(){this.pickOutHandlerService.disablePickOut()},t.prototype.stopPickOut=function(){this.pickOutHandlerService.stopPickOut()},t.prototype.subscribe=function(t){return this.events.subscribe(t)},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:ot}]},t}(),ct=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,Z],declarations:[Q,st],providers:[at,ot],exports:[st],entryComponents:[Q]}]}],t}(),lt=function(){function t(){}return t.forRoot=function(){return{ngModule:t,providers:[T,R]}},t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,ct,G,Z,D,o.MatIconModule],declarations:[U,N,W,F],exports:[U]}]}],t}(),pt=function(){function t(){this.selected=new i.EventEmitter}return t.prototype.onClick=function(t){this.selected.emit(t)},t.prototype.ngOnInit=function(){},t.decorators=[{type:i.Component,args:[{selector:"w-brick-input-placeholder",template:'<div class="placeholder" (click)="onClick($event)">\n    <mat-icon>{{icon}}</mat-icon>\n    <span> {{ text }} </span>\n</div>\n\n<w-loading-wrapper [message]="\'Loading\'" *ngIf="loading"></w-loading-wrapper>\n',changeDetection:i.ChangeDetectionStrategy.OnPush,styles:[".placeholder{padding:15px;display:flex;cursor:pointer;border-radius:4px;align-items:center}mat-icon{margin-right:10px}:host{position:relative;display:block}"]}]}],t.ctorParameters=function(){return[]},t.propDecorators={text:[{type:i.Input}],icon:[{type:i.Input}],loading:[{type:i.Input}],selected:[{type:i.Output}]},t}(),ut=function(){function t(){}return t.prototype.ngOnInit=function(){},t.decorators=[{type:i.Component,args:[{selector:"w-loading-wrapper",template:'<div *ngIf="message" class="w-loading-wrapper__message">{{message}}</div>\n<div class="w-loading-wrapper__wrapper"></div>\n',changeDetection:i.ChangeDetectionStrategy.OnPush,styles:[".w-loading-wrapper__message,.w-loading-wrapper__wrapper{position:absolute;top:0;left:0;bottom:0;right:0}.w-loading-wrapper__wrapper{opacity:.2;cursor:progress}.w-loading-wrapper__message{display:flex;justify-content:center;align-items:center}"]}]}],t.propDecorators={message:[{type:i.Input}]},t}(),dt=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,o.MatIconModule],exports:[pt,ut],declarations:[pt,ut],providers:[]}]}],t}(),ht=function(){function t(t){this.injector=t,this.doc=null,this.doc=this.injector.get(e.DOCUMENT),this.onCopyBound=this.onCopy.bind(this),this.doc.addEventListener("copy",this.onCopyBound)}return t.prototype.onWallInitialize=function(t){this.wallModel=t},t.prototype.onCopy=function(t){var e=this.getSelectedTextRepresentation();e.length&&(t.preventDefault(),this.addToClipboard(t,e))},t.prototype.onWallPluginDestroy=function(){this.doc.removeEventListener("click",this.onCopy)},t.prototype.addToClipboard=function(t,e){t.clipboardData.setData("text/plain",e)},t.prototype.getSelectedTextRepresentation=function(){var t=this;return this.wallModel.api.ui.getSelectedBrickIds().map(function(e){return t.wallModel.api.core.getBrickTextRepresentation(e)}).map(function(t){return t.trim()}).join("\n")},t}(),ft=function(){function t(t){this.injector=t,this.processingUndo=!1,this.undoPlanStack=[],this.redoPlanStack=[],this.doc=this.injector.get(e.DOCUMENT)}return t.prototype.onWallInitialize=function(t){var e=this;this.wallModel=t,this.wallModel.registerApi("undo",{undo:this.undo.bind(this),undoSize:this.undoSize.bind(this),redo:this.redo.bind(this),redoSize:this.redoSize.bind(this),clear:this.clear.bind(this)}),this.apiSubscription=this.wallModel.api.core.subscribe(function(t){e.wallModelEventHandler(t)}),this.onUndoKeyHandlerBound=this.onUndoKeyHandler.bind(this),this.doc.addEventListener("keydown",this.onUndoKeyHandlerBound)},t.prototype.onWallPluginDestroy=function(){this.apiSubscription.unsubscribe(),this.doc.removeEventListener("keydown",this.onUndoKeyHandlerBound)},t.prototype.onUndoKeyHandler=function(t){90===t.keyCode&&t.ctrlKey&&(t.preventDefault(),t.stopPropagation(),t.shiftKey?this.redo():this.undo())},t.prototype.undoSize=function(){return this.undoPlanStack.length},t.prototype.redoSize=function(){return this.redoPlanStack.length},t.prototype.wallModelEventHandler=function(t){this.processingUndo||t instanceof m&&t.beforeEventType!==w&&(this.undoPlanStack.push(this.wallModel.api.core.getPlan()),this.redoPlanStack=[])},t.prototype.redo=function(){var t=this.redoPlanStack.pop();t&&(this.processingUndo=!0,this.wallModel.api.core.setPlan(t),this.undoPlanStack.push(t),this.processingUndo=!1)},t.prototype.undo=function(){var t=this.undoPlanStack.pop();t&&(this.processingUndo=!0,this.wallModel.api.core.setPlan(t),this.redoPlanStack.push(t),this.processingUndo=!1)},t.prototype.clear=function(){this.undoPlanStack=[],this.redoPlanStack=[]},t}(),gt={dropTypes:{horizontal:"horizontal",vertical:"vertical"},dropSides:{left:"left",right:"right",top:"top",bottom:"bottom"}},yt=function(){function t(t,e){this.injector=t,this.isMouseSelection=!1,this.placeholderHeight=2,this.isEnableDropZoneHighlight=!1,this.options=u({shouldUnselectBrick:function(){return!0}},e)}return t.prototype.onWallInitialize=function(t){var i=this;this.wallModel=t,this.doc=this.injector.get(e.DOCUMENT),this.pickOutService=this.injector.get(at),this.radar=this.injector.get(z),this.placeholderRenderer=this.injector.get(O),this.towService=this.injector.get(q),this.onMouseDownBound=this.onMouseDown.bind(this),this.onKeyDownHandlerBound=this.onKeyDownHandler.bind(this),this.doc.addEventListener("mousedown",this.onMouseDownBound),this.doc.addEventListener("keydown",this.onKeyDownHandlerBound),this.pickOutServiceSubscription=this.pickOutService.subscribe(function(t){t instanceof it&&(i.isMouseSelection=!0,i.wallModel.api.ui.disableMediaInteraction()),t instanceof et&&i.wallModel.api.ui.selectBricks(t.ids),t instanceof tt&&i.wallModel.api.ui.enableMediaInteraction()}),this.towServiceSubscription=this.towService.subscribe(function(t){if(t instanceof K&&(i.wallModel.api.core.getBrickSnapshot(t.slaveId)?i.isEnableDropZoneHighlight=!0:i.isEnableDropZoneHighlight=!1,i.nearestBrickToDrop=null,i.placeholderRenderer.clear()),t instanceof V&&i.nearestBrickToDrop&&i.isEnableDropZoneHighlight){var e=[],n=i.wallModel.api.ui.getSelectedBrickIds();n.length>1?e=e.concat(n):e.push(t.slaveId),i.nearestBrickToDrop.type===gt.dropTypes.horizontal&&(i.nearestBrickToDrop.side===gt.dropSides.top&&i.wallModel.api.core.moveBrickBeforeBrickId(e,i.nearestBrickToDrop.spot.data.brickId),i.nearestBrickToDrop.side===gt.dropSides.bottom&&i.wallModel.api.core.moveBrickAfterBrickId(e,i.nearestBrickToDrop.spot.data.brickId)),i.nearestBrickToDrop.type===gt.dropTypes.vertical&&(i.nearestBrickToDrop.side===gt.dropSides.left&&i.wallModel.api.core.moveBrickToNewColumn(e,i.nearestBrickToDrop.spot.data.brickId,gt.dropSides.left),i.nearestBrickToDrop.side===gt.dropSides.right&&i.wallModel.api.core.moveBrickToNewColumn(e,i.nearestBrickToDrop.spot.data.brickId,gt.dropSides.right)),i.nearestBrickToDrop=null,i.placeholderRenderer.clear()}var o;if(t instanceof $&&i.isEnableDropZoneHighlight)if(i.radar.filterSpots(function(t){return t.data.isBeacon}).forEach(function(e){(e.updateInfo(),o)?e.getMinimalDistanceToPoint(t.mousePosition.clientX,t.mousePosition.clientY)<o.getMinimalDistanceToPoint(t.mousePosition.clientX,t.mousePosition.clientY)&&(o=e):o=e}),o)if(o.getMinimalDistanceToPoint(t.mousePosition.clientX,t.mousePosition.clientY)<50){if(i.nearestBrickToDrop={spot:o,side:null,type:null},t.mousePosition.clientX<o.position.x&&(i.nearestBrickToDrop.type=gt.dropTypes.vertical,i.nearestBrickToDrop.side=gt.dropSides.left),t.mousePosition.clientX>o.position.x+o.size.width&&(i.nearestBrickToDrop.type=gt.dropTypes.vertical,i.nearestBrickToDrop.side=gt.dropSides.right),t.mousePosition.clientX>o.position.x&&t.mousePosition.clientX<o.position.x+o.size.width){i.nearestBrickToDrop.type=gt.dropTypes.horizontal;var r=o.position.y+o.size.height/2;i.nearestBrickToDrop.side=t.mousePosition.clientY<r?gt.dropSides.top:gt.dropSides.bottom}i.renderPlaceholder()}else i.nearestBrickToDrop=null,i.placeholderRenderer.clear();else i.nearestBrickToDrop=null,i.placeholderRenderer.clear()})},t.prototype.onMouseDown=function(t){!this.isMouseOverDraggableBox(t.clientX,t.clientY)&&this.options.shouldUnselectBrick(t)&&this.wallModel.api.ui.unSelectBricks()},t.prototype.onKeyDownHandler=function(t){var e=this.wallModel.api.ui.getSelectedBrickIds(),i=e[0],n=e[e.length-1];if("Delete"===t.key&&e.length&&(t.preventDefault(),this.wallModel.api.ui.unSelectBricks(),this.wallModel.api.ui.removeBricks(e)),"Enter"===t.key&&e.length&&(t.preventDefault(),this.wallModel.api.ui.focusOnBrickId(i),this.wallModel.api.ui.unSelectBricks()),"ArrowUp"===t.key&&e.length){t.preventDefault();var o=this.wallModel.api.core.getPreviousBrickId(n);o&&(t.shiftKey?e.length>1&&this.isDownSelectionDirection()?this.wallModel.api.ui.removeBrickFromSelection(n):this.wallModel.api.ui.addBrickToSelection(o):this.wallModel.api.ui.selectBrick(o))}if("ArrowDown"===t.key&&e.length){t.preventDefault();var r=this.wallModel.api.core.getNextBrickId(n);r&&(t.shiftKey?e.length>1&&!this.isDownSelectionDirection()?this.wallModel.api.ui.removeBrickFromSelection(n):this.wallModel.api.ui.addBrickToSelection(r):this.wallModel.api.ui.selectBrick(r))}"Escape"===t.key&&(t.preventDefault(),e.length&&this.wallModel.api.ui.unSelectBricks())},t.prototype.onWallPluginDestroy=function(){this.doc.removeEventListener("mousedown",this.onMouseDownBound),this.doc.removeEventListener("keydown",this.onKeyDownHandlerBound),this.wallModel=null,this.pickOutServiceSubscription.unsubscribe(),this.towServiceSubscription.unsubscribe()},t.prototype.isMouseOverDraggableBox=function(t,e){for(var i=document.elementFromPoint(t,e);i&&!i.classList.contains("wall-canvas-brick__draggable-box");)i=i.parentElement;return Boolean(i)},t.prototype.isDownSelectionDirection=function(){var t=this.wallModel.api.ui.getSelectedBrickIds(),e=t.length,i=t[e-1],n=t[e-2];return this.wallModel.api.core.isBrickAheadOf(n,i)},t.prototype.renderPlaceholder=function(){var t,e,i,n,o=this.nearestBrickToDrop.spot,r=this.nearestBrickToDrop.side,s=this.nearestBrickToDrop.type;s===gt.dropTypes.horizontal&&(t=o.position.x,i=o.size.width,r===gt.dropSides.top&&(e=o.position.y-this.placeholderHeight),r===gt.dropSides.bottom&&(e=o.position.y+o.size.height),n=!0),s===gt.dropTypes.vertical&&(e=o.position.y,i=o.size.height,n=!1,r===gt.dropSides.left&&(t=o.position.x),r===gt.dropSides.right&&(t=o.position.x+o.size.width)),this.placeholderRenderer.render(t,e,i,n)},t}(),mt="divider",kt=function(){function t(){}return t.decorators=[{type:i.Component,args:[{selector:"divider-brick",template:'<div class="wrapper">\n    <div class="divider"></div>\n</div>\n',styles:[".wrapper{height:36px}.divider{border-bottom:1px solid silver;height:1px;padding-top:17px}"]}]}],t}(),vt=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:mt,component:kt,name:"Divider",description:"Visually divide blocks"})}return t.decorators=[{type:i.NgModule,args:[{exports:[kt],declarations:[kt],entryComponents:[kt]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),bt=function(){function t(t){this.brickSnapshot=t}return t.prototype.getText=function(){return this.brickSnapshot.state.text},t}(),wt=function(){return function(t){for(var e=t;e.childNodes.length;)e=e.childNodes[0];this.child=e}}(),Bt=function(){return function(t){for(var e=t;e.childNodes.length;)e=e.childNodes[e.childNodes.length-1];this.child=e}}(),St=function(){function t(t,e){this.root=t,this.subStringHTML=e,this.firstLevelSubStringNodes=[],this.subString=this.getSubStringTextContent(),0!==e.length&&(1===this.root.childNodes.length?this.firstLevelSubStringNodes=Array.from(this.root.childNodes):this.root.childNodes.length>1&&(this.firstLevelSubStringNodes=this.findFirstLevelSubStringNodes()))}return t.prototype.findFirstLevelSubStringNodes=function(){for(var t=this.root.childNodes.length-1,e=this.root.childNodes[t],i="",n=[];e&&!i.includes(this.subString);)i=e.textContent+i,n.push(e),t--,e=this.root.childNodes[t];return n.reverse()},t.prototype.getSubStringTextContent=function(){var t=document.createElement("P");return t.innerHTML=this.subStringHTML,t.textContent},t}(),xt=function(){function t(t){this.el=t}return t.prototype.isCaretAtEnd=function(){var t=!1,e=window.getSelection();if(e.rangeCount){var i=e.getRangeAt(0),n=i.cloneRange();n.selectNodeContents(this.el),n.setStart(i.endContainer,i.endOffset),t=""===n.toString().trim()}return t},t.prototype.isCaretAtStart=function(){var t=!1,e=window.getSelection();if(e.rangeCount){var i=e.getRangeAt(0),n=i.cloneRange();n.selectNodeContents(this.el),n.setEnd(i.startContainer,i.startOffset),t=""===n.toString().trim()}return t},t}(),Ct=function(){function t(t,e,i){this.leftText=t,this.rightText=e,this.targetNode=i}return t.prototype.get=function(){var t=this.createElementClone(this.targetNode),e=document.createElement("SPAN");t.innerHTML=this.leftText,e.innerHTML=this.rightText,t.appendChild(e),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.padding="0",t.style.margin="0",document.body.appendChild(t);var i=e.offsetLeft;return t.remove(),i},t.prototype.createElementClone=function(t){var e=document.createElement("DIV"),i=getComputedStyle(t);return[].forEach.call(i,function(t){e.style[t]=i[t]}),e},t}(),Mt=function(){function t(t,e,i){if(this.leftText=t,this.rightText=e,this.targetNode=i,""===t&&""===e)this.isOnFirstLine=!0,this.isOnLastLine=!0;else{var n=this.createElementClone(this.targetNode);document.body.appendChild(n);var o=document.createElement("SPAN"),r=document.createElement("SPAN");n.appendChild(o),n.appendChild(r),o.innerText="a";var s=o.offsetHeight;o.innerHTML=t,r.innerHTML=e,this.isOnFirstLine=0===o.textContent.length||o.offsetHeight===s&&o.getBoundingClientRect().top===r.getBoundingClientRect().top,this.isOnLastLine=r.offsetHeight===s,n.remove()}}return t.prototype.createElementClone=function(t){var e=document.createElement("DIV"),i=getComputedStyle(t);return[].forEach.call(i,function(t){e.style[t]=i[t]}),e},t}(),It=function(){function t(t,e){this.el=t,this.position=e}return t.prototype.place=function(){var t=document.createRange(),e=window.getSelection();t.setStart(this.el,this.position),e.removeAllRanges(),e.addRange(t)},t}(),Pt=function(){function t(t){this.str=t}return t.prototype.get=function(){var t=document.createElement("P");return t.innerHTML=this.str,t.textContent.trim().length?this.str:""},t}(),Tt="text-supporting-brick",Rt=function(){function t(t){this.baseTextBrickComponent=t}return t.prototype.execute=function(t){if(this.baseTextBrickComponent.isCaretAtLastLine()){t.preventDefault();var e=this.baseTextBrickComponent.getCaretLeftCoordinate(),i={initiator:Tt,details:{bottomKey:!0,caretLeftCoordinate:e}};this.baseTextBrickComponent.wallUiApi.focusOnNextTextBrick(this.baseTextBrickComponent.id,i)}},t}(),Et=function(){function t(t){this.baseTextBrickComponent=t}return t.prototype.execute=function(t){t.preventDefault();var e=window.getSelection(),i=this.baseTextBrickComponent.getSplittedText(e.focusOffset,e.focusNode);i.left=this.baseTextBrickComponent.cleanUpText(i.left),i.right=this.baseTextBrickComponent.cleanUpText(i.right),i.left.length?i.right.length?this.splitBrickForTwoPart(i.left,i.right):this.addEmptyBrickAfter():i.right.length?this.addEmptyTextBrickBefore():this.addEmptyBrickAfter()},t.prototype.splitBrickForTwoPart=function(t,e){this.addBrickAfter(e),this.baseTextBrickComponent.setTextState(t),this.baseTextBrickComponent.saveCurrentState()},t.prototype.addEmptyTextBrickBefore=function(){var t={text:"",tabs:this.baseTextBrickComponent.scope.tabs};this.baseTextBrickComponent.wallModel.api.core.addBrickBeforeBrickId(this.baseTextBrickComponent.id,"text",t),this.baseTextBrickComponent.editor.nativeElement.scrollIntoView({behavior:"smooth",block:"center",inline:"start"})},t.prototype.addEmptyBrickAfter=function(){this.addBrickAfter("")},t.prototype.addBrickAfter=function(t){var e=this,i={text:t,tabs:this.baseTextBrickComponent.scope.tabs},n=this.baseTextBrickComponent.wallModel.api.core.addBrickAfterBrickId(this.baseTextBrickComponent.id,"text",i);setTimeout(function(){e.baseTextBrickComponent.wallUiApi.focusOnBrickId(n.id)})},t}(),Ot=function(){function t(t){this.baseTextBrickComponent=t}return t.prototype.execute=function(t){t.preventDefault();var e={initiator:Tt,details:{leftKey:!0}};this.baseTextBrickComponent.wallUiApi.focusOnPreviousTextBrick(this.baseTextBrickComponent.id,e)},t}(),Dt=function(){function t(t){this.baseTextBrickComponent=t}return t.prototype.execute=function(t){t.preventDefault();var e={initiator:Tt,details:{rightKey:!0}};this.baseTextBrickComponent.wallUiApi.focusOnNextTextBrick(this.baseTextBrickComponent.id,e)},t}(),Nt=function(){function t(t){this.baseTextBrickComponent=t}return t.prototype.execute=function(t){var e=this.baseTextBrickComponent.getCaretLeftCoordinate();if(this.baseTextBrickComponent.isCaretAtFirstLine()){t.preventDefault();var i={initiator:Tt,details:{topKey:!0,caretLeftCoordinate:e}};this.baseTextBrickComponent.wallModel.api.ui.focusOnPreviousTextBrick(this.baseTextBrickComponent.id,i)}},t}(),At="FIRST",Lt="LAST",_t=function(){function t(){this.stateChanges=new i.EventEmitter,this.keypressHandlers={top:new Nt(this),enter:new Et(this),left:new Ot(this),right:new Dt(this),bottom:new Rt(this)},this.scope={text:"",tabs:0},this.maxTabNumber=3,this.textChange=new n.Subject}return t.prototype.ngOnInit=function(){var t=this;this.state&&this.state.text!==this.scope.text&&this.setTextState(this.state.text),this.scope.tabs=this.state.tabs||0,this.onPasteBound=this.onPaste.bind(this),this.editor.nativeElement.addEventListener("paste",this.onPasteBound),this.textChangeSubscription=this.textChange.subscribe(function(){t.setTextState(t.scope.text),t.saveCurrentState()}),this.wallUiApi=this.wallModel.api.ui},t.prototype.onWallStateChange=function(t){this.scope.tabs=this.state.tabs||this.scope.tabs,t&&t.text!==this.scope.text&&this.setTextState(t.text)},t.prototype.ngOnDestroy=function(){this.editor.nativeElement.removeEventListener("paste",this.onPasteBound),this.textChangeSubscription.unsubscribe()},t.prototype.onPaste=function(t){var e=this;t.preventDefault();var i=t.clipboardData.getData("text/plain").split("\n").map(function(t){return t.trim()}).filter(function(t){return t.length});1===i.length?document.execCommand("insertHTML",!1,i[0]):i.length>1&&i.reverse().forEach(function(t){return e.wallModel.api.core.addBrickAfterBrickId(e.id,"text",{text:t})})},t.prototype.onTextChange=function(){this.textChange.next(this.scope.text)},t.prototype.onKeyPress=function(t){this.noMetaKeyIsPressed(t)&&("ArrowUp"===t.code&&this.topKeyPressed(t),"ArrowDown"===t.code&&this.bottomKeyPressed(t),"ArrowLeft"===t.code&&this.isCaretAtStart()&&this.leftKeyPressed(t),"ArrowRight"===t.code&&this.isCaretAtEnd()&&this.rightKeyPressed(t),"Enter"!==t.code&&13!==t.keyCode&&"NumpadEnter"!==t.code||this.enterKeyPressed(t),27===t.keyCode&&this.escapeKeyPressed(t),"Backspace"!==t.code&&8!==t.keyCode||this.isTextSelected()||this.backSpaceKeyPressed(t),"Delete"===t.code&&this.scope.text.length&&this.isCaretAtEnd()&&!this.isTextSelected()&&this.concatWithNextTextSupportingBrick(t),"Tab"===t.code&&this.isCaretAtStart()&&this.onTabPressed(t),"Delete"===t.code&&""===this.scope.text&&this.onDeleteAndFocusToNext(t))},t.prototype.proxyToKeyHandler=function(t,e){this.keypressHandlers[t].execute(e)},t.prototype.topKeyPressed=function(t){this.proxyToKeyHandler("top",t)},t.prototype.bottomKeyPressed=function(t){this.proxyToKeyHandler("bottom",t)},t.prototype.enterKeyPressed=function(t){this.proxyToKeyHandler("enter",t)},t.prototype.leftKeyPressed=function(t){this.proxyToKeyHandler("left",t)},t.prototype.rightKeyPressed=function(t){this.proxyToKeyHandler("right",t)},t.prototype.escapeKeyPressed=function(t){},t.prototype.onTabPressed=function(t){t.preventDefault(),this.increaseTab(),this.saveCurrentState()},t.prototype.backSpaceKeyPressed=function(t){this.isCaretAtStart()&&(this.scope.tabs?(this.decreaseTab(),this.saveCurrentState()):this.scope.text.length?this.concatWithPreviousTextSupportingBrick(t):this.onDeleteAndFocusToPrevious(t))},t.prototype.isCaretAtFirstLine=function(){return this.getCursorPositionInLine().isOnFirstLine},t.prototype.isCaretAtLastLine=function(){return this.getCursorPositionInLine().isOnLastLine},t.prototype.getCaretLeftCoordinate=function(){var t=window.getSelection(),e=this.getSplittedText(t.focusOffset,t.focusNode);return new Ct(e.left,e.right,this.editor.nativeElement).get()},t.prototype.getCursorPositionInLine=function(){var t=window.getSelection(),e=this.getSplittedText(t.focusOffset,t.focusNode);return new Mt(e.left,e.right,this.editor.nativeElement)},t.prototype.concatWithPreviousTextSupportingBrick=function(t){var e=this,i=this.wallModel.api.core.getPreviousTextBrickId(this.id);if(i){t.preventDefault();var n=this.wallModel.api.core.getBrickSnapshot(i);this.wallModel.api.core.updateBrickState(i,{text:this.cleanUpText(n.state.text)+this.scope.text}),setTimeout(function(){var t={initiator:Tt,details:{concatText:!0,concatenationText:e.scope.text}};e.wallUiApi.focusOnBrickId(i,t),e.wallUiApi.removeBrick(e.id)})}},t.prototype.concatWithNextTextSupportingBrick=function(t){var e=this,i=this.wallModel.api.core.getNextTextBrickId(this.id);if(i){t.preventDefault();var n=this.wallModel.api.core.getBrickSnapshot(i).state.text||"";this.setTextState(this.scope.text+n),this.saveCurrentState(),this.wallModel.api.core.removeBrick(i),setTimeout(function(){e.placeCaretBaseOnConcatenatedText(n)},10)}},t.prototype.onDeleteAndFocusToPrevious=function(t){t.preventDefault();var e=this.wallModel.api.core.getPreviousTextBrickId(this.id);if(this.wallUiApi.removeBrick(this.id),e){var i={initiator:Tt,details:{deletePreviousText:!0}};this.wallUiApi.focusOnBrickId(e,i)}},t.prototype.onDeleteAndFocusToNext=function(t){t.preventDefault();var e=this.wallModel.api.core.getNextTextBrickId(this.id);if(e){this.wallUiApi.removeBrick(this.id);var i={initiator:Tt,details:{deletePreviousText:!0}};this.wallUiApi.focusOnBrickId(e,i)}},t.prototype.getSplittedText=function(t,e){return{left:this.scope.text.slice(0,t),right:this.scope.text.slice(t)||""}},t.prototype.onWallFocus=function(t){if(this.editor.nativeElement!==document.activeElement&&(this.editor.nativeElement.focus(),t&&t.initiator===Tt&&(t.details.deletePreviousText&&this.placeCaretAtEnd(),t.details.concatText&&this.placeCaretBaseOnConcatenatedText(t.details.concatenationText),t.details.leftKey&&this.placeCaretAtEnd(),t.details.rightKey&&this.placeCaretAtStart(),t.details.bottomKey||t.details.topKey))){var e=t.details.bottomKey?At:Lt;this.placeCaretAtLeftCoordinate(t.details.caretLeftCoordinate,e)}},t.prototype.setTextState=function(t){void 0===t&&(t=""),this.scope.text=this.cleanUpText(t)},t.prototype.increaseTab=function(){this.scope.tabs<this.maxTabNumber&&this.scope.tabs++},t.prototype.decreaseTab=function(){this.scope.tabs>0&&this.scope.tabs--},t.prototype.saveCurrentState=function(){this.stateChanges.emit(this.scope)},t.prototype.isTextSelected=function(){return!window.getSelection().isCollapsed},t.prototype.placeCaretAtStart=function(){var t=new wt(this.editor.nativeElement);this.placeCaretAtNodeStart(t.child)},t.prototype.placeCaretAtEnd=function(){var t=new Bt(this.editor.nativeElement);this.placeCaretAtNodeEnd(t.child)},t.prototype.placeCaretAtNodeStart=function(t){this.placeCaretAtNodeToPosition(t,0)},t.prototype.placeCaretAtNodeEnd=function(t){this.placeCaretAtNodeToPosition(t,t.textContent.length)},t.prototype.placeCaretAtNodeToPosition=function(t,e){new It(t,e).place()},t.prototype.placeCaretBaseOnConcatenatedText=function(t){if(""!==t){var e=new St(this.editor.nativeElement,t).firstLevelSubStringNodes[0];if(e){var i=void 0,n=void 0;if(e.nodeType===Node.TEXT_NODE){i=e;var o=document.createElement("P");o.innerHTML=t;var r=o.childNodes[0].textContent;n=i.textContent.length-r.length}else i=new wt(e).child,n=0;this.placeCaretAtNodeToPosition(i,n)}}},t.prototype.placeCaretAtLeftCoordinate=function(t,e){e===Lt?this.placeCaretAtEnd():this.placeCaretAtStart()},t.prototype.isCaretAtStart=function(){return new xt(this.editor.nativeElement).isCaretAtStart()},t.prototype.isCaretAtEnd=function(){return new xt(this.editor.nativeElement).isCaretAtEnd()},t.prototype.cleanUpText=function(t){return new Pt(t).get()},t.prototype.noMetaKeyIsPressed=function(t){return!(t.shiftKey||t.altKey||t.ctrlKey||t.metaKey)},t.propDecorators={id:[{type:i.Input}],state:[{type:i.Input}],wallModel:[{type:i.Input}],stateChanges:[{type:i.Output}],editor:[{type:i.ViewChild,args:["editor"]}]},t}(),zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.placeholder="Header",e}return p(e,t),e.decorators=[{type:i.Component,args:[{selector:"header-brick",template:'<div #editor\n     attr.placeholder="{{placeholder}}"\n     (input)="onTextChange()"\n     [(ngModel)]="scope.text"\n     [ngClass]="\'header-brick-tabs-\' + scope.tabs"\n     (keydown)="onKeyPress($event)"\n     class="text-brick__editor"\n     contenteditable>\n</div>\n',styles:["div{display:block}div[contenteditable]{letter-spacing:-.002em;word-break:break-all;padding:6px 2px;margin:8px 0 0}div[contenteditable]:focus{outline:0}div[contenteditable]:empty:before{content:attr(placeholder)}div.header-brick-tabs-1{margin-left:1.5rem}div.header-brick-tabs-2{margin-left:3rem}div.header-brick-tabs-3{margin-left:4.5rem}"]}]}],e}(_t),Ft=function(){function t(t,e){this.elementRef=t,this.renderer=e,this.propValueAccessor="textContent"}return t.prototype.callOnChange=function(){"function"==typeof this.onChange&&this.onChange(this.elementRef.nativeElement[this.propValueAccessor])},t.prototype.callOnTouched=function(){"function"==typeof this.onTouched&&this.onTouched()},t.prototype.writeValue=function(t){var e=null===t?"":t;this.renderer.setProperty(this.elementRef.nativeElement,this.propValueAccessor,e)},t.prototype.registerOnChange=function(t){this.onChange=t},t.prototype.registerOnTouched=function(t){this.onTouched=t},t.prototype.setDisabledState=function(t){t?(this.renderer.setAttribute(this.elementRef.nativeElement,"disabled","true"),this.removeDisabledState=this.renderer.listen(this.elementRef.nativeElement,"keydown",this.listenerDisabledState)):this.removeDisabledState&&(this.renderer.removeAttribute(this.elementRef.nativeElement,"disabled"),this.removeDisabledState())},t.prototype.listenerDisabledState=function(t){t.preventDefault()},t.decorators=[{type:i.Directive,args:[{selector:"[contenteditable]",providers:[{provide:s.NG_VALUE_ACCESSOR,useExisting:t,multi:!0}]}]}],t.ctorParameters=function(){return[{type:i.ElementRef},{type:i.Renderer2}]},t.propDecorators={propValueAccessor:[{type:i.Input}],callOnChange:[{type:i.HostListener,args:["input"]}],callOnTouched:[{type:i.HostListener,args:["blur"]}]},t}(),Wt=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[s.FormsModule],exports:[Ft],declarations:[Ft]}]}],t}(),jt=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:"header",component:zt,supportText:!0,textRepresentation:bt,name:"Header",description:"A large header with margins"})}return t.decorators=[{type:i.NgModule,args:[{imports:[s.FormsModule,e.CommonModule,Wt],exports:[zt],declarations:[zt],entryComponents:[zt]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),Ht=new i.InjectionToken("IWallFileUploader"),Ut=function(){function t(t){this.ngxStickyModalRef=t}return t.prototype.ngOnInit=function(){var t=this;setTimeout(function(){t.srcInput.nativeElement.focus()},10)},t.prototype.applyImageSrc=function(){this.notify({src:this.srcInput.nativeElement.value})},t.prototype.onFileChange=function(t){this.notify({file:t.target.files[0]})},t.prototype.notify=function(t){this.ngxStickyModalRef.close(t)},t.prototype.onSubmit=function(t){t.preventDefault(),this.applyImageSrc()},t.decorators=[{type:i.Component,args:[{template:'<div class="w-context-panel w-brick-input mat-elevation-z4">\n    <div class="w-brick-input__body">\n        <form (submit)="onSubmit($event)">\n            <mat-form-field>\n                <input #src matInput placeholder="Paste the image link">\n            </mat-form-field>\n\n            <button mat-flat-button color="primary" (click)="applyImageSrc()" type="button">\n                Add image\n            </button>\n        </form>\n\n        <p class="w-brick-input__description mb-2">\n            Add link or upload image\n        </p>\n\n        <input accept="image/*" (change)="onFileChange($event)" type="file">\n    </div>\n</div>\n',styles:["button,mat-form-field{width:100%}"]}]}],t.ctorParameters=function(){return[{type:a.StickyModalRef}]},t.propDecorators={srcInput:[{type:i.ViewChild,args:["src"]}]},t}(),Kt=function(){function t(t,e,n,o,r){this.renderer=t,this.componentFactoryResolver=e,this.ngxStickyModalService=n,this.wallFileUploader=o,this.el=r,this.stateChanges=new i.EventEmitter,this.scope={src:"",metadata:null,width:null},this.isSrcBase64=!1,this.resizable={resize:this.onResize.bind(this),resizeStart:this.onResizeStart.bind(this),resizeEnd:this.onResizeEnd.bind(this)}}return t.prototype.ngOnInit=function(){Object.assign(this.scope,this.state),this.processNewState()},t.prototype.onWallStateChange=function(t){t&&t.src!==this.scope.src&&(Object.assign(this.scope,this.state),this.processNewState())},t.prototype.processNewState=function(){this.scope.src&&(this.isSrcBase64=this.isBase64(this.scope.src),this.scope.width||this.setUpImageWidth(),this.isSrcBase64&&this.processBase64ImgSrc())},t.prototype.onWallFocus=function(){var t=this;this.scope.src||setTimeout(function(){t.showPanel()},0)},t.prototype.onResize=function(t){this.scope.width=this.lastWidth+t.offset},t.prototype.onResizeStart=function(){this.lastWidth=this.scope.width},t.prototype.onResizeEnd=function(){this.save()},t.prototype.applyImageSrc=function(t,e){var i=this;return this.isImage(t).then(function(){return i.scope.src=t,i.isSrcBase64=!1,e&&(i.scope.metadata=e),i.save(),i.setUpImageWidth()})["catch"](function(){alert("Please enter valid url")})},t.prototype.applyImageFile=function(t){var e=this;return new f(t).getBase64Representation().then(function(t){return e.applyImageSrc(t).then(function(){return e.processBase64ImgSrc()})})},t.prototype.processBase64ImgSrc=function(){var t=this;return this.uploadImage().then(function(e){return t.applyImageSrc(e.downloadURL,{path:e.path})},function(){})},t.prototype.showPanel=function(){var t=this;this.imageSrcPlaceholderRef||(this.imageSrcPlaceholderRef=this.ngxStickyModalService.open({component:Ut,positionStrategy:{name:a.StickyPositionStrategy.flexibleConnected,options:{relativeTo:this.el.nativeElement}},position:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top"},componentFactoryResolver:this.componentFactoryResolver}),this.imageSrcPlaceholderRef.result.then(function(e){t.imageSrcPlaceholderRef=null,e.src?t.applyImageSrc(e.src):t.applyImageFile(e.file)},function(){t.imageSrcPlaceholderRef=null}))},t.prototype.isBase64=function(t){t=t.replace(/^data:image\/(png|jpg|jpeg);base64,/,"");try{return btoa(atob(t))===t}catch(e){return!1}},t.prototype.uploadImage=function(){if(!this.wallFileUploader.canUploadFile())return Promise.reject();var t=(new d).get(),e=new h(this.scope.src,t).getFile();return this.wallFileUploader.upload(this.id,e)},t.prototype.setUpImageWidth=function(){var t=this;return this.loadImage(this.scope.src).then(function(){t.scope.width=t.image.nativeElement.width,t.save()})},t.prototype.save=function(){this.stateChanges.emit(this.scope)},t.prototype.loadImage=function(t){return this.isImage(t)},t.prototype.isImage=function(t){return new Promise(function(e,i){var n=new Image;n.onload=function(){e()},n.onerror=function(){i()},n.src=t})},t.decorators=[{type:i.Component,args:[{selector:"img-brick",template:'<div class="container" [style.width]="scope.width ? scope.width+\'px\' : \'auto\'">\n    <img [tow-slave]="id" #image *ngIf="scope.src" [wResizable]="resizable" [src]="scope.src">\n\n    <a mat-button *ngIf="!isSrcBase64 && scope.src" [href]="scope.src" target="_blank" class="original-btn">\n        Show original\n    </a>\n</div>\n\n<w-brick-input-placeholder\n    *ngIf="!scope.src"\n    [text]="\'Add an Image\'"\n    [icon]="\'image\'" (selected)="showPanel()">\n</w-brick-input-placeholder>\n',styles:[":host{position:relative;display:block}:host:hover .original-btn{display:block}.original-btn{position:absolute;top:15px;right:15px;display:none}.container{margin:0 auto;position:relative;max-width:100%}.container .left-handler,.container .right-handler{position:absolute;display:block;width:40px;height:100%;top:0;cursor:col-resize}.container .left-handler{left:0}.container .right-handler{right:0}.container img{-o-object-fit:cover;object-fit:cover;width:100%;height:100%;margin:0 auto;display:block;cursor:pointer}"]}]}],t.ctorParameters=function(){return[{type:i.Renderer2},{type:i.ComponentFactoryResolver},{type:a.StickyModalService},{type:undefined,decorators:[{type:i.Inject,args:[Ht]}]},{type:i.ElementRef}]},t.propDecorators={id:[{type:i.Input}],state:[{type:i.Input}],stateChanges:[{type:i.Output}],image:[{type:i.ViewChild,args:["image"]}]},t}(),Vt=function(){function t(t){this.wallFileUploader=t}return t.prototype.remove=function(t){var e=t.state;return e.src&&e.metadata&&e.metadata.path?this.wallFileUploader.remove(e.metadata.path):Promise.resolve()},t.decorators=[{type:i.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:i.Inject,args:[Ht]}]}]},t}(),$t=function(){function t(t){this.brickSnapshot=t}return t.prototype.getText=function(){return"img!"+this.brickSnapshot.state.src},t}(),Xt=function(){function t(){this.mouseDownEvent=new i.EventEmitter}return t.prototype.mouseDown=function(t){this.mouseDownEvent.emit(t)},t.decorators=[{type:i.Component,args:[{template:'<span [ngClass]="customClassName"></span>'}]}],t.propDecorators={customClassName:[{type:i.Input}],mouseDownEvent:[{type:i.Output}],mouseDown:[{type:i.HostListener,args:["mousedown",["$event"]]}]},t}(),Yt=function(){function t(t,e,i,n){this.el=t,this.zone=e,this.cfr=i,this.doc=n,this.resizeData=null}return t.prototype.ngOnInit=function(){var t=this,e=this.createHandler("left-handler"),i=this.createHandler("right-handler");e.instance.mouseDownEvent.subscribe(function(e){t.mouseDownHandler(e,!0)}),i.instance.mouseDownEvent.subscribe(function(e){t.mouseDownHandler(e,!1)}),this.doc.addEventListener("mousemove",function(e){t.resizeData&&(t.resizeData.xCurrent=e.clientX,t.resizeData.isLeftDirection?t.resizeData.offset=t.resizeData.xInitial-t.resizeData.xCurrent:t.resizeData.isRightDirection&&(t.resizeData.offset=t.resizeData.xCurrent-t.resizeData.xInitial),t.wResizable.resize&&t.wResizable.resize(t.resizeData))}),this.doc.addEventListener("mouseup",function(){t.wResizable.resizeEnd&&t.wResizable.resizeEnd(t.resizeData),t.resizeData=null})},t.prototype.createHandler=function(t){var e=this.el.createComponent(this.cfr.resolveComponentFactory(Xt));return e.instance.customClassName=t,e},t.prototype.mouseDownHandler=function(t,e){t.preventDefault(),t.stopPropagation(),this.resizeData={xInitial:t.clientX,xCurrent:t.clientX,offset:0,isLeftDirection:e,isRightDirection:!e},this.wResizable.resizeStart&&this.wResizable.resizeStart(this.resizeData)},t.decorators=[{type:i.Directive,args:[{selector:"[wResizable]"}]}],t.ctorParameters=function(){return[{type:i.ViewContainerRef},{type:i.NgZone},{type:i.ComponentFactoryResolver},{type:undefined,decorators:[{type:i.Inject,args:[e.DOCUMENT]}]}]},t.propDecorators={wResizable:[{type:i.Input}]},t}(),qt=function(){function t(){}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule],exports:[Yt],declarations:[Yt,Xt],entryComponents:[Xt]}]}],t}(),Jt=function(){function t(t,e){var i=this;this.brickRegistry=t,this.imgModel=e,this.brickRegistry.register({tag:"image",component:Kt,textRepresentation:$t,destructor:function(t){return i.imgModel.remove(t)},getBrickResourcePaths:function(t){var e=t.state;return e.metadata&&e.metadata.path?[e.metadata.path]:[]},name:"Image",description:"Embed with a link"})}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,dt,qt,G,a.StickyModalModule,o.MatButtonModule,o.MatInputModule,o.MatFormFieldModule],exports:[Kt],declarations:[Kt,Ut],entryComponents:[Kt,Ut],providers:[Vt]}]}],t.ctorParameters=function(){return[{type:T},{type:Vt}]},t}(),Zt=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.placeholder="Quote",e}return p(e,t),e.decorators=[{type:i.Component,args:[{selector:"quote-brick",template:'<div #editor\n     attr.placeholder="{{placeholder}}"\n     (input)="onTextChange()"\n     [(ngModel)]="scope.text"\n     (keydown)="onKeyPress($event)"\n     class="editor"\n     contenteditable>\n</div>',styles:["[contenteditable]{max-width:100%;width:100%;padding-left:1.25em;padding-right:1.25em;font-size:21px}[contenteditable]:focus{outline:0}[contenteditable]:empty:before{content:attr(placeholder)}"]}]}],e}(_t),Gt=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:"quote",component:Zt,supportText:!0,textRepresentation:bt,name:"Quote",description:"Capture a quote"})}return t.decorators=[{type:i.NgModule,args:[{imports:[s.FormsModule,Wt],exports:[Zt],declarations:[Zt],entryComponents:[Zt]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),Qt=function(){function t(t){this.ngxStickyModalRef=t}return t.prototype.ngOnInit=function(){var t=this;setTimeout(function(){t.srcInput.nativeElement.focus()},10)},t.prototype.applySrc=function(){this.ngxStickyModalRef.close({src:this.srcInput.nativeElement.value})},t.prototype.onSubmit=function(t){t.preventDefault(),this.applySrc()},t.decorators=[{type:i.Component,args:[{template:'<div class="w-context-panel w-brick-input mat-elevation-z4">\n    <div class="w-brick-input__header"></div>\n\n    <div class="w-brick-input__body">\n        <form (submit)="onSubmit($event)">\n            <mat-form-field>\n                <input #src matInput placeholder="Paste the youtube video link">\n            </mat-form-field>\n\n            <button mat-flat-button color="primary" (click)="applySrc()" type="button">\n                Add video\n            </button>\n        </form>\n\n        <p class="w-brick-input__description">\n            Youtube video\n        </p>\n    </div>\n\n    <div class="w-brick-input__footer"></div>\n</div>\n',styles:["button,mat-form-field{width:100%}"]}]}],t.ctorParameters=function(){return[{type:a.StickyModalRef}]},t.propDecorators={srcInput:[{type:i.ViewChild,args:["src"]}]},t}(),te=function(){function t(t,e,n,o){this.renderer2=t,this.el=e,this.componentFactoryResolver=n,this.ngxStickyModalService=o,this.stateChanges=new i.EventEmitter,this.uiStates={initial:"initial",video:"video"},this.uiState=this.uiStates.initial,this.scope={src:""}}return t.prototype.ngOnInit=function(){var t=this;this.state&&this.state.src!==this.scope.src&&(this.scope.src=this.state.src,this.scope.src&&(this.uiState=this.uiStates.video,setTimeout(function(){t.renderer2.setAttribute(t.iframe.nativeElement,"src",t.scope.src)},10)))},t.prototype.onWallStateChange=function(t){var e=this;t&&t.src!==this.scope.src&&(this.scope.src=t.src,this.scope.src&&(this.uiState=this.uiStates.video,setTimeout(function(){e.renderer2.setAttribute(e.iframe.nativeElement,"src",e.scope.src)},10)))},t.prototype.onWallFocus=function(){var t=this;this.uiState!==this.uiStates.initial||this.videoSrcPlaceholderRef||setTimeout(function(){t.showVideoPanel()},0)},t.prototype.applySrc=function(t){if(this.uiState=this.uiStates.initial,t.length){var e=t.split("=")[1];e&&(this.scope.src="https://www.youtube.com/embed/"+e,this.renderer2.setAttribute(this.iframe.nativeElement,"src",this.scope.src),this.save(),this.uiState=this.uiStates.video)}},t.prototype.showVideoPanel=function(){var t=this;this.videoSrcPlaceholderRef=this.ngxStickyModalService.open({component:Qt,positionStrategy:{name:a.StickyPositionStrategy.flexibleConnected,options:{relativeTo:this.el.nativeElement}},position:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top"},componentFactoryResolver:this.componentFactoryResolver}),this.videoSrcPlaceholderRef.result.then(function(e){t.videoSrcPlaceholderRef=null,t.applySrc(e.src)},function(){t.videoSrcPlaceholderRef=null})},t.prototype.save=function(){this.stateChanges.emit(this.scope)},t.decorators=[{type:i.Component,args:[{selector:"video-brick",template:'<iframe height="400" [hidden]="uiState !== uiStates.video" #iframe frameborder="0" allowfullscreen></iframe>\n\n<w-brick-input-placeholder\n    [text]="\'Add a Video\'"\n    [icon]="\'music_video\'"\n    [hidden]="uiState === uiStates.video" (selected)="showVideoPanel()">\n</w-brick-input-placeholder>\n',styles:[":host{position:relative;display:block}:host iframe{width:100%}"]}]}],t.ctorParameters=function(){return[{type:i.Renderer2},{type:i.ElementRef},{type:i.ComponentFactoryResolver},{type:a.StickyModalService}]},t.propDecorators={id:[{type:i.Input}],state:[{type:i.Input}],stateChanges:[{type:i.Output}],iframe:[{type:i.ViewChild,args:["iframe"]}]},t}(),ee=function(){function t(t){this.brickSnapshot=t}return t.prototype.getText=function(){return"video!"+this.brickSnapshot.state.src},t}(),ie=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:"video",component:te,textRepresentation:ee,name:"Video",description:"Embed from Youtube and more"})}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,a.StickyModalModule,dt,o.MatButtonModule,o.MatInputModule,o.MatFormFieldModule],exports:[te],declarations:[te,Qt],entryComponents:[te,Qt]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),ne=function(){function t(t){this.ngxStickyModalRef=t}return t.prototype.ngOnInit=function(){var t=this;setTimeout(function(){t.srcInput.nativeElement.focus()},10)},t.prototype.applySrc=function(){this.ngxStickyModalRef.close({src:this.srcInput.nativeElement.value})},t.prototype.onSubmit=function(t){t.preventDefault(),this.applySrc()},t.decorators=[{type:i.Component,args:[{template:'<div class="w-context-panel w-brick-input mat-elevation-z4">\n    <div class="w-brick-input__body">\n        <form (submit)="onSubmit($event)">\n            <mat-form-field>\n                <input #src matInput placeholder="Paste in https://...">\n            </mat-form-field>\n\n            <button mat-flat-button color="primary" (click)="applySrc()" type="button">\n                Create Bookmark\n            </button>\n        </form>\n\n        <p class="w-brick-input__description">\n            Create a visual bookmark from a link...\n        </p>\n    </div>\n</div>\n',styles:["button,mat-form-field{width:100%}"]}]}],t.ctorParameters=function(){return[{type:a.StickyModalRef}]},t.propDecorators={srcInput:[{type:i.ViewChild,args:["src"]}]},t}(),oe=function(){function t(t,e,n){this.el=t,this.componentFactoryResolver=e,this.ngxStickyModalService=n,this.stateChanges=new i.EventEmitter,this.scope={src:null,description:null,image:{height:null,width:null,url:null},logo:{height:null,width:null,url:null},title:null,author:null},this.loading=!1}return t.prototype.ngOnInit=function(){Object.assign(this.scope,this.state)},t.prototype.onWallStateChange=function(t){t&&t.src!==this.scope.src&&Object.assign(this.scope,this.state)},t.prototype.applySrc=function(t){var e=this;t.length&&(this.isValidUrl(t)?(this.loading=!0,this.getWebPageMetaInfo(t).then(function(i){Object.assign(e.scope,i),e.scope.src=t,e.save(),e.loading=!1},function(){e.loading=!1})):alert("Url is invalid"))},t.prototype.showPanel=function(){var t=this;this.loading||this.ngxStickyModalService.open({component:ne,positionStrategy:{name:a.StickyPositionStrategy.flexibleConnected,options:{relativeTo:this.el.nativeElement}},position:{originX:"center",originY:"bottom",overlayX:"center",overlayY:"top"},componentFactoryResolver:this.componentFactoryResolver}).result.then(function(e){t.applySrc(e.src)},function(){})},t.prototype.onWallFocus=function(){var t=this;this.scope.src||setTimeout(function(){t.showPanel()},0)},t.prototype.save=function(){this.stateChanges.emit(this.scope)},t.prototype.getWebPageMetaInfo=function(t){return fetch("https://api.microlink.io/?url="+t).then(function(t){return t.json().then(function(t){var e=t.data;return{image:e.image,description:e.description,logo:e.logo,title:e.title,author:e.author}})})},t.prototype.isValidUrl=function(t){var e;try{e=new URL(t)}catch(i){}return Boolean(e)},t.decorators=[{type:i.Component,args:[{selector:"web-bookmark-brick",template:'<w-brick-input-placeholder\n    [text]="\'Add a Web Bookmark\'"\n    [icon]="\'link\'"\n    [loading]="loading"\n    *ngIf="!scope.src"\n    (selected)="showPanel()">\n</w-brick-input-placeholder>\n\n<div *ngIf="scope.src" class="web-bookmark">\n    <a [href]="scope.src" class="web-bookmark__content" target="_blank" [title]="scope.src">\n        <p class="web-bookmark__title">{{scope.title}}</p>\n        <p class="web-bookmark__description">{{scope.description}}</p>\n\n        <div class="web-bookmark__link">\n            <img *ngIf="scope.logo" [src]="scope.logo.url" alt="scope.title">\n            <p>{{scope.src}}</p>\n        </div>\n    </a>\n\n    <div class="web-bookmark__img" [tow-slave]="id" [style.backgroundImage]="\'url(\'+ scope.image?.url +\')\'">\n    </div>\n</div>\n',styles:[":host{position:relative;display:block}:host .web-bookmark{display:flex;height:6rem;overflow:hidden;outline:silver solid 1px;margin:.3rem 0}:host .web-bookmark:hover{cursor:pointer}:host .web-bookmark__content{width:70%;border-right:none;text-decoration:none;margin:.4rem .7rem;border-radius:2px;overflow:hidden}:host .web-bookmark__title{margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}:host .web-bookmark__description{overflow:hidden;height:2.4rem;margin-bottom:.3rem}:host .web-bookmark__link{display:flex;align-items:center}:host .web-bookmark__link img{width:18px;height:18px;-o-object-fit:cover;object-fit:cover;margin-right:.4rem}:host .web-bookmark__link p{overflow:hidden;margin:0;height:1.2rem}:host .web-bookmark__img{width:30%;background-position:center center;background-size:cover}"]}]}],t.ctorParameters=function(){return[{type:i.ElementRef},{type:i.ComponentFactoryResolver},{type:a.StickyModalService}]},t.propDecorators={id:[{type:i.Input}],state:[{type:i.Input}],stateChanges:[{type:i.Output}]},t}(),re=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:"webbookmark",component:oe,textRepresentation:ee,name:"Web Bookmark",description:"Save a link as a visual bookmark"})}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,a.StickyModalModule,dt,G,o.MatButtonModule,o.MatInputModule,o.MatFormFieldModule],exports:[oe],declarations:[ne,oe],entryComponents:[ne,oe],providers:[]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),se=[{value:"javascript",name:"Javascript"},{value:"shell",name:"Shell"},{value:"xml",name:"XML"}],ae=function(){function t(t,e){this.config=t,this.ngxStickyModalRef=e}return t.prototype.onSelected=function(t){this.ngxStickyModalRef.close(t)},t.decorators=[{type:i.Component,args:[{selector:"w-mode-list-component",template:'<div class="w-context-panel mat-elevation-z4">\n    <mat-action-list>\n        <button mat-list-item *ngFor="let mode of config.modes" (click)="onSelected(mode)">\n            {{mode.name}}\n        </button>\n    </mat-action-list>\n</div>\n'}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:i.Inject,args:[a.STICKY_MODAL_DATA]}]},{type:a.StickyModalRef}]},t}(),ce=function(){function t(t,e){this.ngxStickyModalService=t,this.componentFactoryResolver=e,this.scope={code:"",mode:se[0].value},this.ui={displayModeName:se[0].name},this.stateChanges=new i.EventEmitter}return t.prototype.ngOnInit=function(){var t=this;Object.assign(this.scope,this.state),this.codeMirrorInstance=c(this.container.nativeElement,{value:"",mode:this.scope.mode,theme:"neo",dragDrop:!1,scrollbarStyle:null}),this.codeMirrorInstance.on("change",function(){t.scope.code=t.codeMirrorInstance.getValue(),t.saveState()}),this.processNewState()},t.prototype.onWallStateChange=function(t){t&&t.code!==this.scope.code&&(Object.assign(this.scope,this.state),this.processNewState())},t.prototype.processNewState=function(){var t=this;this.codeMirrorInstance.setValue(this.scope.code),this.scope.mode!==this.codeMirrorInstance.getMode().name&&this.codeMirrorInstance.setOption("mode",this.scope.mode),this.ui.displayModeName=se.find(function(e){return e.value===t.scope.mode}).name},t.prototype.saveState=function(){this.stateChanges.emit(this.scope)},t.prototype.onModeSelected=function(){var t=this,e=this.mode.nativeElement.getBoundingClientRect(),i=se.map(function(e){return u({},e,{selected:e.value===t.scope.mode})});this.ngxStickyModalService.open({component:ae,data:{modes:i},positionStrategy:{name:a.StickyPositionStrategy.coordinate,options:{clientX:e.x,clientY:e.y+35}},componentFactoryResolver:this.componentFactoryResolver}).result.then(function(e){Object.assign(t.scope,u({},t.state,{mode:e.value})),t.processNewState()},function(){})},t.decorators=[{type:i.Component,args:[{selector:"code-brick",template:'<div #container></div>\n\n<button #mode (click)="onModeSelected()" mat-button>{{ui.displayModeName}}</button>\n',styles:["::ng-deep .CodeMirror{padding:1rem 1.4rem;height:auto}::ng-deep .CodeMirror .CodeMirror-cursor{width:1px}::ng-deep .CodeMirror .CodeMirror-scroll{overflow:hidden!important}.mat-button{position:absolute;right:.7rem;bottom:.7rem;z-index:2}"]}]}],t.ctorParameters=function(){return[{type:a.StickyModalService},{type:i.ComponentFactoryResolver}]},t.propDecorators={id:[{type:i.Input}],state:[{type:i.Input}],container:[{type:i.ViewChild,args:["container",{read:i.ElementRef}]}],mode:[{type:i.ViewChild,args:["mode",{read:i.ElementRef}]}],stateChanges:[{type:i.Output}]},t}(),le=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:"code",component:ce,name:"Code",description:"Capture a code snippet"})}return t.decorators=[{type:i.NgModule,args:[{imports:[e.CommonModule,lt,dt,a.StickyModalModule,o.MatButtonModule,o.MatListModule],declarations:[ce,ae],entryComponents:[ce,ae]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),pe=function(){function t(t,e){this.brickRegistry=t,this.config=e,this.selectedTag$=new n.BehaviorSubject(null),this.bricksList$=new n.BehaviorSubject([]),this.subscriptions=[],this.updateBricksList("")}return t.prototype.ngOnInit=function(){var t=this;this.subscriptions.push(this.config.text$.subscribe(function(e){t.updateBricksList(e.slice(1))})),this.subscriptions.push(this.config.up$.subscribe(function(){t.onNavigationUpDownHandler(!0)})),this.subscriptions.push(this.config.down$.subscribe(function(){t.onNavigationUpDownHandler(!1)})),this.subscriptions.push(this.config.enter$.subscribe(function(){t.notifySelectedTag()}))},t.prototype.onBrickSelected=function(t){this.selectedTag$.next(t.tag),this.notifySelectedTag()},t.prototype.trackByFn=function(t,e){return e.tag},t.prototype.ngOnDestroy=function(){this.subscriptions.forEach(function(t){t.unsubscribe()})},t.prototype.notifySelectedTag=function(){this.config.selectedTag$.next(this.selectedTag$.getValue())},t.prototype.updateBricksList=function(t){var e=this.brickRegistry.getAll().filter(function(e){return"text"!==e.tag&&e.tag.includes(t)}).sort(function(e,i){return e.tag.startsWith(t)?-1:i.tag.startsWith(t)?1:0});e.length?this.selectedTag$.next(e[0].tag):this.selectedTag$.next(null),this.bricksList$.next(e)},t.prototype.onNavigationUpDownHandler=function(t){var e=this.selectedTag$.getValue(),i=this.bricksList$.getValue();if(e&&i.length>1){var n=i.findIndex(function(t){return t.tag===e}),o=void 0;t?(o=i[n-1])||(o=i[i.length-1]):(o=i[n+1])||(o=i[0]),this.selectedTag$.next(o.tag),setTimeout(function(){document.getElementsByClassName("w-bricks-list__selected")[0].scrollIntoView()})}},t.decorators=[{type:i.Component,args:[{selector:"w-bricks-list",template:'<div class="w-context-panel w-bricks-list mat-elevation-z4">\n    <mat-list>\n        <mat-list-item *ngFor="let brickDescription of bricksList$ | async; trackBy: trackByFn"\n                       [ngClass]="{\'w-bricks-list__selected\': (selectedTag$ | async) === brickDescription.tag}"\n                       (click)="onBrickSelected(brickDescription)">\n            <p mat-line>\n                {{brickDescription.name}}\n            </p>\n            <p mat-line>\n                {{brickDescription.description}}\n            </p>\n        </mat-list-item>\n    </mat-list>\n</div>\n',changeDetection:i.ChangeDetectionStrategy.OnPush}]}],t.ctorParameters=function(){return[{type:T},{type:undefined,decorators:[{type:i.Inject,args:[a.STICKY_MODAL_DATA]}]}]},t}(),ue=function(){function t(t,e,i){if(this.root=t,this.targetElement=e,this.offset=i,t===e)this.leftTree=t,this.rightTree=t;else{var n=e.parentNode,o=n.cloneNode(!1),r=n.cloneNode(!1);if(o.appendChild(document.createTextNode(e.textContent.slice(i))),this.appendNextSiblingsToNode(o,e),r.appendChild(document.createTextNode(e.textContent.slice(0,i))),this.prependPreviousSiblingsToNode(r,e),t===n)this.leftTree=r,this.rightTree=o;else{for(var s=void 0,a=void 0,c=n.parentNode;t.contains(c)||c===t;)a=c.cloneNode(!1),s=c.cloneNode(!1),this.prependPreviousSiblingsToNode(s,n),s.appendChild(r),r=s,this.appendNextSiblingsToNode(a,n),a.prepend(o),o=a,n=c,c=c.parentNode;this.leftTree=r,this.rightTree=o}}}return t.prototype.prependPreviousSiblingsToNode=function(t,e){for(var i=e.previousSibling;i;)t.prepend(i.cloneNode(!0)),i=i.previousSibling},t.prototype.appendNextSiblingsToNode=function(t,e){for(var i=e.nextSibling;i;)t.appendChild(i.cloneNode(!0)),i=i.nextSibling},t}(),de=function(){function t(t){this.root=t}return t.prototype.traversePostOrder=function(t){this._traversePostOrder(this.root,t)},t.prototype.traversePreOrder=function(t){this._traversePreOrder(this.root,t)},t.prototype.traversePostPreOrder=function(t){this._traversePostPreOrder(this.root,t)},t.prototype.getPreOrderNodes=function(){var t=[];return this.traversePreOrder(function(e){t.push(e)}),t},t.prototype.getPostOrderNodes=function(){var t=[];return this.traversePostOrder(function(e){t.push(e)}),t},t.prototype.getPostPreOrderNodes=function(){var t=[];return this.traversePostPreOrder(function(e){t.push(e)}),t},t.prototype._traversePostOrder=function(t,e){var i=this;Array.from(t.childNodes).forEach(function(t){t.childNodes&&t.childNodes.length&&i._traversePostOrder(t,e),e(t)})},t.prototype._traversePreOrder=function(t,e){var i=this;Array.from(t.childNodes).forEach(function(t){e(t),t.childNodes&&t.childNodes.length&&i._traversePreOrder(t,e)})},t.prototype._traversePostPreOrder=function(t,e){var i=this;Array.from(t.childNodes).forEach(function(t){e(t),t.childNodes&&t.childNodes.length&&i._traversePostPreOrder(t,e),e(t)})},t}(),he=function(){function t(t){this.config=t,this.ui={showLinkForm:!1}}return t.prototype.ngOnInit=function(){this.config.api.saveSelection()},t.prototype.bold=function(){this.config.api.bold()},t.prototype.italic=function(){this.config.api.italic()},t.prototype.link=function(){var t=this;this.switchLinkFormVisibility(),this.ui.showLinkForm?(this.config.api.saveSelection(),setTimeout(function(){t.config.api.isLinkSelected()&&(t.linkEl.nativeElement.value=t.config.api.getSelectedLinkHref()),t.linkEl.nativeElement.focus()})):this.config.api.restoreSelection()},t.prototype.applyLink=function(){this.config.api.restoreSelection(),this.config.api.isLinkSelected()?this.config.api.changeLinkUrl(this.linkEl.nativeElement.value):this.config.api.createLink(this.linkEl.nativeElement.value),this.switchLinkFormVisibility()},t.prototype.unlink=function(){this.config.api.restoreSelection(),this.config.api.unlink(),this.switchLinkFormVisibility()},t.prototype.switchLinkFormVisibility=function(){this.ui.showLinkForm=!this.ui.showLinkForm},t.decorators=[{type:i.Component,args:[{selector:"w-text-context-menu",template:'<div class="w-context-panel w-text-context-menu-panel mat-elevation-z4">\n    <div>\n        <button [ngClass]="{\'w-text-context-menu__selected-link\': config.api.isLinkSelected()}"\n                mat-button\n                (click)="link()">\n            Link\n        </button>\n\n        <button mat-button (click)="bold()">Bold</button>\n        <button mat-button (click)="italic()">Italic</button>\n    </div>\n\n    <div>\n        <form *ngIf="ui.showLinkForm" (submit)="applyLink()">\n            <mat-form-field>\n                <input #linkEl #src matInput placeholder="Paste the url">\n            </mat-form-field>\n\n            <div>\n                <button (click)="applyLink()"\n                        type="button"\n                        mat-button>\n                    Link\n                </button>\n\n                <button *ngIf="config.api.isLinkSelected()"\n                        (click)="unlink()"\n                        type="button"\n                        mat-button>\n                    Unlink\n                </button>\n            </div>\n        </form>\n    </div>\n</div>\n'}]}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:i.Inject,args:[a.STICKY_MODAL_DATA]}]}]},t.propDecorators={linkEl:[{type:i.ViewChild,args:["linkEl"]}]},t}(),fe=function(t){function e(e,i,o,s,a){var c=t.call(this)||this;return c.zone=e,c.ngxStickyModalService=i,c.cd=o,c.componentFactoryResolver=s,c.el=a,c.placeholder=null,c.up$=new n.Subject,c.down$=new n.Subject,c.enter$=new n.Subject,c.selectedTag$=new n.Subject,c.subscriptions=[],c.api={bold:c.bold.bind(c),italic:c.italic.bind(c),createLink:c.createLink.bind(c),changeLinkUrl:c.changeLinkUrl.bind(c),isLinkSelected:c.isLinkSelected.bind(c),getSelectedLinkHref:c.getSelectedLinkHref.bind(c),saveSelection:c.saveSelection.bind(c),restoreSelection:c.restoreSelection.bind(c),unlink:c.unlink.bind(c)},c.selectedTag$.subscribe(function(t){t&&(c.hideBricksList(),c.wallModel.api.core.turnBrickInto(c.id,t),t===mt&&c.wallModel.api.core.addBrickAfterBrickId(c.id,"text"))}),c.subscriptions.push(n.fromEvent(c.el.nativeElement,"mouseup").pipe(r.filter(function(){return Boolean(c.scope.text.length)}),r.debounceTime(500),r.filter(function(){return c.el.nativeElement.contains(window.getSelection().anchorNode)})).subscribe(function(t){c.onTextSelection()})),c}return p(e,t),e.prototype.ngOnInit=function(){t.prototype.ngOnInit.call(this)},e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this),this.subscriptions.forEach(function(t){t.unsubscribe()})},e.prototype.onBlur=function(){this.placeholder=null},e.prototype.onFocus=function(){this.placeholder="Type '/' for commands"},e.prototype.onKeyPress=function(e){t.prototype.onKeyPress.call(this,e),this.hideContextMenuModal()},e.prototype.onClick=function(t){var e=t.target;this.isHTMLElement(e)&&"A"===e.tagName&&window.open(e.getAttribute("href"),"_blank")},e.prototype.topKeyPressed=function(e){this.brickSelectionModalRef?(e.preventDefault(),e.stopPropagation(),this.up$.next()):t.prototype.topKeyPressed.call(this,e)},e.prototype.bottomKeyPressed=function(e){this.brickSelectionModalRef?(e.preventDefault(),e.stopPropagation(),this.down$.next()):t.prototype.bottomKeyPressed.call(this,e)},e.prototype.enterKeyPressed=function(e){var i=this;if(this.brickSelectionModalRef)this.enter$.next(),setTimeout(function(){i.hideBricksList()},10);else if(this.isTag()){var n=this.scope.text.slice(1);this.wallModel.api.core.turnBrickInto(this.id,n),"d"===n&&this.wallModel.api.core.addBrickAfterBrickId(this.id,"text")}else t.prototype.enterKeyPressed.call(this,e)},e.prototype.getSplittedText=function(t,e){var i=new ue(this.editor.nativeElement,e,t);return{left:i.leftTree.innerHTML,right:i.rightTree.innerHTML}},e.prototype.escapeKeyPressed=function(t){this.brickSelectionModalRef&&(t.preventDefault(),t.stopPropagation(),this.hideBricksList())},e.prototype.onTextChange=function(){var e=this;if(t.prototype.onTextChange.call(this),this.brickSelectionModalRef)this.scope.text.length||this.hideBricksList();else if("/"===this.scope.text[0]&&1===this.scope.text.length){this.editor.nativeElement.blur();var i=this.el.nativeElement.getBoundingClientRect();this.brickSelectionModalRef=this.ngxStickyModalService.open({component:pe,data:{text$:this.textChange,up$:this.up$,down$:this.down$,enter$:this.enter$,selectedTag$:this.selectedTag$},positionStrategy:{name:a.StickyPositionStrategy.coordinate,options:{clientX:i.x,clientY:i.y+35}},componentFactoryResolver:this.componentFactoryResolver}),setTimeout(function(){e.editor.nativeElement.focus()})}},e.prototype.onPaste=function(e){var i=this,n=this.extractImageDataTransferItem(e.clipboardData.items);n?(e.preventDefault(),new f(n.getAsFile()).getBase64Representation().then(function(t){i.wallModel.api.core.turnBrickInto(i.id,"image",{src:t})})):t.prototype.onPaste.call(this,e)},e.prototype.onTextSelection=function(){this.contextMenuModalRef||(window.getSelection().isCollapsed||this.showContextModal())},e.prototype.bold=function(){document.execCommand("bold",!1)},e.prototype.italic=function(){document.execCommand("italic",!1)},e.prototype.createLink=function(t){document.execCommand("createLink",!1,t)},e.prototype.getSelectedLinkHref=function(){if(this.selectionInfo.selectedLink)return this.selectionInfo.selectedLink.getAttribute("href")},e.prototype.unlink=function(){document.execCommand("unlink",!1)},e.prototype.changeLinkUrl=function(t){this.selectionInfo.selectedLink&&(this.selectionInfo.selectedLink.setAttribute("href",t),this.triggerEditorChange())},e.prototype.isLinkSelected=function(){return Boolean(this.selectionInfo&&this.selectionInfo.selectedLink)},e.prototype.saveSelection=function(){this.selectionInfo={selectedLink:this.getSelectedLink(),ranges:this.getSelectedRanges()}},e.prototype.restoreSelection=function(){var t=window.getSelection();t.removeAllRanges();for(var e=0,i=this.selectionInfo.ranges.length;e<i;++e)t.addRange(this.selectionInfo.ranges[e])},e.prototype.getSelectedLink=function(){var t,e,i=window.getSelection(),n=this.el.nativeElement.contains(i.anchorNode),o=this.el.nativeElement.contains(i.focusNode);return n&&(t=this.findParentLink(i.anchorNode)),o&&(e=this.findParentLink(i.focusNode)),t||(e||(i.anchorNode!==i.focusNode&&o&&n?this.findLinkBetweenNodes(i.anchorNode,i.focusNode):void 0))},e.prototype.triggerEditorChange=function(){this.editor.nativeElement.dispatchEvent(new Event("input"))},e.prototype.showContextModal=function(){var t=this;this.editor.nativeElement.blur();var e=window.getSelection().getRangeAt(0).getBoundingClientRect();this.contextMenuModalRef=this.ngxStickyModalService.open({component:he,data:{api:this.api},positionStrategy:{name:a.StickyPositionStrategy.coordinate,options:{clientX:e.left+(e.right-e.left)/2.5,clientY:e.top-35}},overlayConfig:{hasBackdrop:!1},componentFactoryResolver:this.componentFactoryResolver}),this.contextMenuModalRef.result.then(function(){t.hideContextMenuModal()},function(){t.hideContextMenuModal()}),setTimeout(function(){t.editor.nativeElement.focus()})},e.prototype.getSelectedRanges=function(){for(var t=window.getSelection(),e=[],i=0,n=t.rangeCount;i<n;++i)e.push(t.getRangeAt(i));return e},e.prototype.extractImageDataTransferItem=function(t){var e;for(e in t)if(t.hasOwnProperty(e)){var i=t[e];if("file"===i.kind)return i}},e.prototype.isTag=function(){return this.scope.text&&"/"===this.scope.text[0]&&this.wallModel.api.core.isRegisteredBrick(this.scope.text.slice(1))},e.prototype.hideBricksList=function(){this.brickSelectionModalRef&&(this.brickSelectionModalRef.close(),this.brickSelectionModalRef=null)},e.prototype.hideContextMenuModal=function(){this.contextMenuModalRef&&(this.contextMenuModalRef.close(),this.contextMenuModalRef=null)},e.prototype.findParentLink=function(t){for(var e=t,i=null;!i&&e!==this.el.nativeElement;)"A"===e.tagName&&(i=e),e=e.parentElement;return i},e.prototype.findLinkBetweenNodes=function(t,e){var i=this,n=new de(this.editor.nativeElement).getPostPreOrderNodes(),o=n.indexOf(t),r=n.indexOf(e);if(r<o){var s=r;r=o,o=s}return n.slice(o,r).filter(function(t){if(i.isHTMLElement(t))return"A"===t.tagName})[0]},e.prototype.isHTMLElement=function(t){return t.querySelector!==undefined},e.decorators=[{type:i.Component,args:[{selector:"text-brick",template:'<p #editor\n   attr.placeholder="{{placeholder}}"\n   (input)="onTextChange()"\n   [(ngModel)]="scope.text"\n   (keydown)="onKeyPress($event)"\n   (click)="onClick($event)"\n   class="text-brick__editor"\n   [ngClass]="\'text-brick-tabs-\' + scope.tabs"\n   (blur)="onBlur()"\n   (focus)="onFocus()"\n   contenteditable\n   [propValueAccessor]="\'innerHTML\'">\n</p>\n',styles:[":host{display:block}:host .text-brick__editor{word-break:break-all;padding:3px 2px;line-height:1.4;margin:0;box-sizing:content-box}:host .text-brick__editor:focus{outline:0}:host [contenteditable]:empty:before{content:attr(placeholder)}:host .text-brick-tabs-1{margin-left:1.5rem}:host .text-brick-tabs-2{margin-left:3rem}:host .text-brick-tabs-3{margin-left:4.5rem}"]}]}],e.ctorParameters=function(){return[{type:i.NgZone},{type:a.StickyModalService},{type:i.ChangeDetectorRef},{type:i.ComponentFactoryResolver},{type:i.ElementRef}]},e.propDecorators={wallModel:[{type:i.Input}]},e}(_t),ge=function(){function t(t){this.brickRegistry=t,this.brickRegistry.register({tag:"text",component:fe,supportText:!0,textRepresentation:bt,name:"Text",description:"Just start writing with plain text"})}return t.decorators=[{type:i.NgModule,args:[{imports:[s.FormsModule,e.CommonModule,Wt,dt,a.StickyModalModule,o.MatButtonModule,o.MatInputModule,o.MatFormFieldModule,o.MatListModule],exports:[fe,pe,he],declarations:[fe,pe,he],entryComponents:[fe,pe,he]}]}],t.ctorParameters=function(){return[{type:T}]},t}(),ye=function(){return function(t){this.spots=t}}(),me=function(){return function(t){this.spots=t}}();t.AddBrickEvent=y,t.BeforeChangeEvent=m,t.BrickRegistry=T,t.CodeBrickModule=le,t.CopyPlugin=ht,t.DIVIDER_BRICK_TAG=mt,t.DividerBrickModule=vt,t.EndPickOut=tt,t.HeaderBrickComponent=zt,t.HeaderBrickModule=jt,t.HelperComponentsModule=dt,t.ImgBrickComponent=Kt,t.ImgBrickModule=Jt,t.LocationToLeftCenterPointEvent=me,t.LocationToTopLeftPointEvent=ye,t.LocationUpdatedEvent=A,t.MoveBrickEvent=k,t.PickOutAreaComponent=Q,t.PickOutAreaDirective=st,t.PickOutItems=et,t.PickOutModule=ct,t.PickOutService=at,t.QuoteBrickModule=Gt,t.Radar=z,t.RadarModule=Z,t.RemoveBrickEvent=v,t.RemoveBricksEvent=b,t.SelectedBrickEvent=j,t.SelectionPlugin=yt,t.SetPlanEvent=w,t.SpotDirective=J,t.SpotModel=L,t.StartPickOut=it,t.StartWorkingEvent=K,t.StopPickOut=nt,t.StopWorkingEvent=V,t.TOW=gt,t.TextBrickComponent=fe,t.TextBrickModule=ge,t.TowModule=G,t.TowService=q,t.TurnBrickIntoEvent=B,t.UNDO_REDO_API_NAME="undo",t.UndoRedoPlugin=ft,t.UpdateBrickStateEvent=S,t.VideoBrickModule=ie,t.WALL={MODES:{EDIT:"edit",READ:"READ"}},t.WALL_FILE_UPLOADER=Ht,t.WallModelFactory=R,t.WallModule=lt,t.WallPluginInitializedEvent=I,t.WebBookmarkBrickModule=re,t.WorkInProgressEvent=$,t.a=_,t.b=ot,t.ba=oe,t.bb=ne,t.bc=ce,t.bd=ae,t.be=pe,t.bf=he,t.c=Y,t.d=X,t.e=D,t.f=E,t.g=O,t.h=U,t.i=H,t.j=N,t.k=W,t.l=F,t.m=pt,t.n=ut,t.o=kt,t.p=Wt,t.q=Ft,t.r=_t,t.s=qt,t.t=Yt,t.u=Xt,t.v=Ut,t.w=Vt,t.x=Zt,t.y=te,t.z=Qt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-wall.umd.min.js.map